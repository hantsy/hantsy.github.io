<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>
  Hantsy
  
  Bai
  
  
  | Building Your First Spring Native Application
  
</title>
<meta name="description" content="My personal website focusing on Java EE/Jakarta EE and Spring.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css"
  integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css"
  integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css"
  href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet"
  href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2021/building-your-first-spring-native-application/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-18SZ2W3GXD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-18SZ2W3GXD');
</script>




  
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="blank" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Building Your First Spring Native Application" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Spring Native beta is released, it is great news for Spring developers. Quarkus got GraalVM native image and Kubernetes support since it was born, and Micronaunt and Oracle Helidon also added GraalVM support for a long time. The image is from https://unsplash.com/photos/sBNx8CBj12w As explained in the GraalVM introduction page, GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a number of other popular languages. GraalVM’s polyglot capabilities make it possible to mix multiple programming languages in a single application while eliminating foreign language call costs. With GraalVM native image, the Java application can be compiled in a system native executable or shared library, and do not need a Java virtual machine at runtime. In this post, we will convert a simple existing reactive mongo example in the hantsy/spring-reactive-sample repository to a native application to experience the new feature brought by Spring Native project. Currently, Spring Native is an experimental project, and the 0.9.1 version works with the exact Spring Boot 2.4.4. Generating a project Assuming you have installed the following software. Java 11Apache Maven 3.8.1Docker, required when building the application with spring-boot:build-imageGraal VM 21.0.0.2, required when building native image directly via native image maven plugin. Open your browser, navigate to https://start.spring.io. Generate a WebFlux project skeleton with dependencies: Spring Native, Lombok, Spring Reactive Web, Spring Data Reactive MongoDB. Extract the files from the downloaded archive, and import into your IDE, eg. Intellij IDEA. Build the Application By default the Spring initializr has configured a maven AOT plugin to generate metadata required by GraalVM at compile stage, and a spring boot maven plugin using paketo buildpack builder paketobuildpacks/builder:tiny to transform your source codes to a cloud native application(Docker image). Simply run the following command to build the application into a Docker image. mvn clean package spring-boot:build-image The Spring Native Reference also introduced build native application through native image maven plugin. Copy the source codes from reactive mongo example to this project, and refactor the pom.xml and introduce multiple maven profiles, and make it work with both cases. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.4.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;spring-native-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;spring-native.version&gt;0.9.1&lt;/spring-native.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;default&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt;**/FunctionalTests.*&lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;spring-native&lt;/id&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-native&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-aot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;test-generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;test-generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-docker-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;image&gt; &lt;name&gt;hantsy/${project.artifactId}:latest&lt;/name&gt; &lt;builder&gt;paketobuildpacks/builder:tiny&lt;/builder&gt; &lt;env&gt; &lt;BP_NATIVE_IMAGE&gt;true&lt;/BP_NATIVE_IMAGE&gt; &lt;/env&gt; &lt;/image&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-native-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;classifier&gt;exec&lt;/classifier&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.graalvm.nativeimage&lt;/groupId&gt; &lt;artifactId&gt;native-image-maven-plugin&lt;/artifactId&gt; &lt;version&gt;21.0.0.2&lt;/version&gt; &lt;configuration&gt; &lt;!-- The native image build needs to know the entry point to your application --&gt; &lt;mainClass&gt;com.example.demo.DemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;native-image&lt;/goal&gt; &lt;/goals&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;functional-test&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;includes&gt; &lt;include&gt;**/FunctionalTests.*&lt;/include&gt; &lt;/includes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/project&gt; By default, we do not contain any Spring native facilities that when run the application it works like a general Spring Boot application. The spring-native profile contains the build progress of AOT maven plugin.The build-docker-image will build the application into a docker image via paketobuildpacks/builder:tiny builder.The build-native-image will use GraalVM native image to build the application as system native executable.The functional-test includes a simple FunctionalTests to verify if the application is working as expected from a client view. Building with Paket BuildPacks The Paket BuildPacks requires docker environment, install it firstly. mvn clean package spring-boot:build-image -Pspring-native,build-docker-image -DskipTests The application requires a running MongoDB at runtime. There is a docker-compose.yml available to bootstrap a MongoDB service in seconds. docker-compose up mongodb Now run the application as any other Docker applications. docker run -rm hantsy/spring-native-demo Building with Native Image maven plugin Make sure you have installed GraalVM firstly, follow the Getting Started guide to install it. Under Windows, GraalVM is still experimental. Consider installing it into a WSL2 system, and IDEA and VSCode have great WSL support. mvn clean package spring-boot:build-image -Pspring-native,build-native-image -DskipTests When there is an executable file in the target folder. Note before running this command, make sure there is a running Mongo service. ./target/com.example.demo.demoapplication You will feel the native application building progress is fairly slow and tedious, both way will consume a couple of minutes (not seconds), it is terrible at development stage for developers. I would like to move it to a CI(continuous integration) service to build it for you. Continuous Integrations I prepared 3 Github actions workflow files to build the project. build - build and run testing code like the general Spring Boot applications.build-docker-image - build the application into a layered docker image via spring-boot:build-image goal, and start up the application and verify it using FunctionalTests mentioned above.build-native-image - build the application into system native executable via GraalVM native image, and start up it and verify the functionality by running FunctionalTests. Ideally, when building Spring Native applications, we only need to focus on the development like building a general Spring Boot application, let CI to hand over the tedious work of building native applications. But unfortunately, there are a lot of limitations in the current version, check the Support section to get a check list of the supported features at the moment. To use those features are not in the support list, you could have to give up Spring Native and switch back to use JVM again. I also tried to enable Data Mongo auditing feature, it does not work on the native mode. Grab a copy of the source codes from hantsy/spring-native-example to experience yourself. The Final Words Quarkus invents the Arc container which provides a subset of CDI APIs for developers, but integrally it produces static codes for beans at compile time instead of generating dynamic proxies at runtime. In my opinion, I would like to see some similar mechanism in Spring Native that provides compile-time byte code enhancement to replace the Spring built-in dynamic proxies for beans, and make it as an alternative to the current Spring IOC container. Personally, I am a little disappointed. &lt;hr&gt;&lt;p&gt;Building Your First Spring Native Application was originally published in Geek Culture on Medium, where people are continuing the conversation by highlighting and responding to this story.&lt;/p&gt;" />
<meta property="og:description" content="The Spring Native beta is released, it is great news for Spring developers. Quarkus got GraalVM native image and Kubernetes support since it was born, and Micronaunt and Oracle Helidon also added GraalVM support for a long time. The image is from https://unsplash.com/photos/sBNx8CBj12w As explained in the GraalVM introduction page, GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a number of other popular languages. GraalVM’s polyglot capabilities make it possible to mix multiple programming languages in a single application while eliminating foreign language call costs. With GraalVM native image, the Java application can be compiled in a system native executable or shared library, and do not need a Java virtual machine at runtime. In this post, we will convert a simple existing reactive mongo example in the hantsy/spring-reactive-sample repository to a native application to experience the new feature brought by Spring Native project. Currently, Spring Native is an experimental project, and the 0.9.1 version works with the exact Spring Boot 2.4.4. Generating a project Assuming you have installed the following software. Java 11Apache Maven 3.8.1Docker, required when building the application with spring-boot:build-imageGraal VM 21.0.0.2, required when building native image directly via native image maven plugin. Open your browser, navigate to https://start.spring.io. Generate a WebFlux project skeleton with dependencies: Spring Native, Lombok, Spring Reactive Web, Spring Data Reactive MongoDB. Extract the files from the downloaded archive, and import into your IDE, eg. Intellij IDEA. Build the Application By default the Spring initializr has configured a maven AOT plugin to generate metadata required by GraalVM at compile stage, and a spring boot maven plugin using paketo buildpack builder paketobuildpacks/builder:tiny to transform your source codes to a cloud native application(Docker image). Simply run the following command to build the application into a Docker image. mvn clean package spring-boot:build-image The Spring Native Reference also introduced build native application through native image maven plugin. Copy the source codes from reactive mongo example to this project, and refactor the pom.xml and introduce multiple maven profiles, and make it work with both cases. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.4.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;spring-native-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;spring-native.version&gt;0.9.1&lt;/spring-native.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;default&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt;**/FunctionalTests.*&lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;spring-native&lt;/id&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-native&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-aot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;test-generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;test-generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-docker-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;image&gt; &lt;name&gt;hantsy/${project.artifactId}:latest&lt;/name&gt; &lt;builder&gt;paketobuildpacks/builder:tiny&lt;/builder&gt; &lt;env&gt; &lt;BP_NATIVE_IMAGE&gt;true&lt;/BP_NATIVE_IMAGE&gt; &lt;/env&gt; &lt;/image&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-native-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;classifier&gt;exec&lt;/classifier&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.graalvm.nativeimage&lt;/groupId&gt; &lt;artifactId&gt;native-image-maven-plugin&lt;/artifactId&gt; &lt;version&gt;21.0.0.2&lt;/version&gt; &lt;configuration&gt; &lt;!-- The native image build needs to know the entry point to your application --&gt; &lt;mainClass&gt;com.example.demo.DemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;native-image&lt;/goal&gt; &lt;/goals&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;functional-test&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;includes&gt; &lt;include&gt;**/FunctionalTests.*&lt;/include&gt; &lt;/includes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/project&gt; By default, we do not contain any Spring native facilities that when run the application it works like a general Spring Boot application. The spring-native profile contains the build progress of AOT maven plugin.The build-docker-image will build the application into a docker image via paketobuildpacks/builder:tiny builder.The build-native-image will use GraalVM native image to build the application as system native executable.The functional-test includes a simple FunctionalTests to verify if the application is working as expected from a client view. Building with Paket BuildPacks The Paket BuildPacks requires docker environment, install it firstly. mvn clean package spring-boot:build-image -Pspring-native,build-docker-image -DskipTests The application requires a running MongoDB at runtime. There is a docker-compose.yml available to bootstrap a MongoDB service in seconds. docker-compose up mongodb Now run the application as any other Docker applications. docker run -rm hantsy/spring-native-demo Building with Native Image maven plugin Make sure you have installed GraalVM firstly, follow the Getting Started guide to install it. Under Windows, GraalVM is still experimental. Consider installing it into a WSL2 system, and IDEA and VSCode have great WSL support. mvn clean package spring-boot:build-image -Pspring-native,build-native-image -DskipTests When there is an executable file in the target folder. Note before running this command, make sure there is a running Mongo service. ./target/com.example.demo.demoapplication You will feel the native application building progress is fairly slow and tedious, both way will consume a couple of minutes (not seconds), it is terrible at development stage for developers. I would like to move it to a CI(continuous integration) service to build it for you. Continuous Integrations I prepared 3 Github actions workflow files to build the project. build - build and run testing code like the general Spring Boot applications.build-docker-image - build the application into a layered docker image via spring-boot:build-image goal, and start up the application and verify it using FunctionalTests mentioned above.build-native-image - build the application into system native executable via GraalVM native image, and start up it and verify the functionality by running FunctionalTests. Ideally, when building Spring Native applications, we only need to focus on the development like building a general Spring Boot application, let CI to hand over the tedious work of building native applications. But unfortunately, there are a lot of limitations in the current version, check the Support section to get a check list of the supported features at the moment. To use those features are not in the support list, you could have to give up Spring Native and switch back to use JVM again. I also tried to enable Data Mongo auditing feature, it does not work on the native mode. Grab a copy of the source codes from hantsy/spring-native-example to experience yourself. The Final Words Quarkus invents the Arc container which provides a subset of CDI APIs for developers, but integrally it produces static codes for beans at compile time instead of generating dynamic proxies at runtime. In my opinion, I would like to see some similar mechanism in Spring Native that provides compile-time byte code enhancement to replace the Spring built-in dynamic proxies for beans, and make it as an alternative to the current Spring IOC container. Personally, I am a little disappointed. &lt;hr&gt;&lt;p&gt;Building Your First Spring Native Application was originally published in Geek Culture on Medium, where people are continuing the conversation by highlighting and responding to this story.&lt;/p&gt;" />
<meta property="og:site_name" content="blank" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-09T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Building Your First Spring Native Application" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-04-09T00:00:00+00:00","datePublished":"2021-04-09T00:00:00+00:00","description":"The Spring Native beta is released, it is great news for Spring developers. Quarkus got GraalVM native image and Kubernetes support since it was born, and Micronaunt and Oracle Helidon also added GraalVM support for a long time. The image is from https://unsplash.com/photos/sBNx8CBj12w As explained in the GraalVM introduction page, GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a number of other popular languages. GraalVM’s polyglot capabilities make it possible to mix multiple programming languages in a single application while eliminating foreign language call costs. With GraalVM native image, the Java application can be compiled in a system native executable or shared library, and do not need a Java virtual machine at runtime. In this post, we will convert a simple existing reactive mongo example in the hantsy/spring-reactive-sample repository to a native application to experience the new feature brought by Spring Native project. Currently, Spring Native is an experimental project, and the 0.9.1 version works with the exact Spring Boot 2.4.4. Generating a project Assuming you have installed the following software. Java 11Apache Maven 3.8.1Docker, required when building the application with spring-boot:build-imageGraal VM 21.0.0.2, required when building native image directly via native image maven plugin. Open your browser, navigate to https://start.spring.io. Generate a WebFlux project skeleton with dependencies: Spring Native, Lombok, Spring Reactive Web, Spring Data Reactive MongoDB. Extract the files from the downloaded archive, and import into your IDE, eg. Intellij IDEA. Build the Application By default the Spring initializr has configured a maven AOT plugin to generate metadata required by GraalVM at compile stage, and a spring boot maven plugin using paketo buildpack builder paketobuildpacks/builder:tiny to transform your source codes to a cloud native application(Docker image). Simply run the following command to build the application into a Docker image. mvn clean package spring-boot:build-image The Spring Native Reference also introduced build native application through native image maven plugin. Copy the source codes from reactive mongo example to this project, and refactor the pom.xml and introduce multiple maven profiles, and make it work with both cases. &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.4.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;spring-native-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;spring-native.version&gt;0.9.1&lt;/spring-native.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.projectreactor&lt;/groupId&gt; &lt;artifactId&gt;reactor-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;default&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;excludes&gt; &lt;exclude&gt;**/FunctionalTests.*&lt;/exclude&gt; &lt;/excludes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;spring-native&lt;/id&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-native&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt; &lt;artifactId&gt;spring-aot-maven-plugin&lt;/artifactId&gt; &lt;version&gt;${spring-native.version}&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;test-generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;test-generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;generate&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;generate&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-docker-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;image&gt; &lt;name&gt;hantsy/${project.artifactId}:latest&lt;/name&gt; &lt;builder&gt;paketobuildpacks/builder:tiny&lt;/builder&gt; &lt;env&gt; &lt;BP_NATIVE_IMAGE&gt;true&lt;/BP_NATIVE_IMAGE&gt; &lt;/env&gt; &lt;/image&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;build-native-image&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;classifier&gt;exec&lt;/classifier&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.graalvm.nativeimage&lt;/groupId&gt; &lt;artifactId&gt;native-image-maven-plugin&lt;/artifactId&gt; &lt;version&gt;21.0.0.2&lt;/version&gt; &lt;configuration&gt; &lt;!-- The native image build needs to know the entry point to your application --&gt; &lt;mainClass&gt;com.example.demo.DemoApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;native-image&lt;/goal&gt; &lt;/goals&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;functional-test&lt;/id&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;includes&gt; &lt;include&gt;**/FunctionalTests.*&lt;/include&gt; &lt;/includes&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring-releases&lt;/id&gt; &lt;name&gt;Spring Releases&lt;/name&gt; &lt;url&gt;https://repo.spring.io/release&lt;/url&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/project&gt; By default, we do not contain any Spring native facilities that when run the application it works like a general Spring Boot application. The spring-native profile contains the build progress of AOT maven plugin.The build-docker-image will build the application into a docker image via paketobuildpacks/builder:tiny builder.The build-native-image will use GraalVM native image to build the application as system native executable.The functional-test includes a simple FunctionalTests to verify if the application is working as expected from a client view. Building with Paket BuildPacks The Paket BuildPacks requires docker environment, install it firstly. mvn clean package spring-boot:build-image -Pspring-native,build-docker-image -DskipTests The application requires a running MongoDB at runtime. There is a docker-compose.yml available to bootstrap a MongoDB service in seconds. docker-compose up mongodb Now run the application as any other Docker applications. docker run -rm hantsy/spring-native-demo Building with Native Image maven plugin Make sure you have installed GraalVM firstly, follow the Getting Started guide to install it. Under Windows, GraalVM is still experimental. Consider installing it into a WSL2 system, and IDEA and VSCode have great WSL support. mvn clean package spring-boot:build-image -Pspring-native,build-native-image -DskipTests When there is an executable file in the target folder. Note before running this command, make sure there is a running Mongo service. ./target/com.example.demo.demoapplication You will feel the native application building progress is fairly slow and tedious, both way will consume a couple of minutes (not seconds), it is terrible at development stage for developers. I would like to move it to a CI(continuous integration) service to build it for you. Continuous Integrations I prepared 3 Github actions workflow files to build the project. build - build and run testing code like the general Spring Boot applications.build-docker-image - build the application into a layered docker image via spring-boot:build-image goal, and start up the application and verify it using FunctionalTests mentioned above.build-native-image - build the application into system native executable via GraalVM native image, and start up it and verify the functionality by running FunctionalTests. Ideally, when building Spring Native applications, we only need to focus on the development like building a general Spring Boot application, let CI to hand over the tedious work of building native applications. But unfortunately, there are a lot of limitations in the current version, check the Support section to get a check list of the supported features at the moment. To use those features are not in the support list, you could have to give up Spring Native and switch back to use JVM again. I also tried to enable Data Mongo auditing feature, it does not work on the native mode. Grab a copy of the source codes from hantsy/spring-native-example to experience yourself. The Final Words Quarkus invents the Arc container which provides a subset of CDI APIs for developers, but integrally it produces static codes for beans at compile time instead of generating dynamic proxies at runtime. In my opinion, I would like to see some similar mechanism in Spring Native that provides compile-time byte code enhancement to replace the Spring built-in dynamic proxies for beans, and make it as an alternative to the current Spring IOC container. Personally, I am a little disappointed. &lt;hr&gt;&lt;p&gt;Building Your First Spring Native Application was originally published in Geek Culture on Medium, where people are continuing the conversation by highlighting and responding to this story.&lt;/p&gt;","headline":"Building Your First Spring Native Application","mainEntityOfPage":{"@type":"WebPage","@id":"/blog/2021/building-your-first-spring-native-application/"},"url":"/blog/2021/building-your-first-spring-native-application/"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body
  class="fixed-top-nav ">

  <!-- Header -->

  <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Hantsy</span>   Bai
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/service/">
                service
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


  <!-- Content -->

  <div class="container mt-5">
    

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Building Your First Spring Native Application</h1>
    <p class="post-meta">April 9, 2021</p>
  </header>

  <article class="post-content">
    <p>The <a href="https://spring.io/blog/2021/03/11/announcing-spring-native-beta">Spring Native beta is released</a>, it is great news for Spring developers. Quarkus got GraalVM native image and Kubernetes support since it was born, and Micronaunt and Oracle Helidon also added GraalVM support for a long time.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*840X1gBH6J1ZrRzdyMnwKQ.jpeg" /><figcaption>The image is from <a href="https://unsplash.com/photos/sBNx8CBj12w">https://unsplash.com/photos/sBNx8CBj12w</a></figcaption></figure><p>As explained in the <a href="https://www.graalvm.org/docs/introduction/">GraalVM introduction page</a>, <em>GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a number of other popular languages. GraalVM’s polyglot capabilities make it possible to mix multiple programming languages in a single application while eliminating foreign language call costs.</em></p><p>With GraalVM native image, the Java application can be compiled in a system native executable or shared library, and do not need a Java virtual machine at runtime.</p><p>In this post, we will convert a simple existing <a href="https://github.com/hantsy/spring-reactive-sample/tree/master/boot-data-mongo-auditing">reactive mongo example</a> in the <a href="https://github.com/hantsy/spring-reactive-sample">hantsy/spring-reactive-sample</a> repository to a native application to experience the new feature brought by Spring Native project.</p><blockquote><em>Currently, Spring Native is an experimental project, and the 0.9.1 version works with the exact Spring Boot 2.4.4.</em></blockquote><h3>Generating a project</h3><p>Assuming you have installed the following software.</p><ul><li>Java 11</li><li>Apache Maven 3.8.1</li><li>Docker, required when building the application with spring-boot:build-image</li><li>Graal VM 21.0.0.2, required when building native image directly via native image maven plugin.</li></ul><p>Open your browser, navigate to <a href="https://start.spring.io">https://start.spring.io</a>.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*9Esfdipj9eil4qZ5.png" /></figure><p>Generate a WebFlux project skeleton with dependencies: Spring Native, Lombok, Spring Reactive Web, Spring Data Reactive MongoDB.</p><p>Extract the files from the downloaded archive, and import into your IDE, eg. Intellij IDEA.</p><h3>Build the Application</h3><p>By default the Spring initializr has configured a maven AOT plugin to generate metadata required by GraalVM at compile stage, and a spring boot maven plugin using <a href="https://paketo.io/">paketo buildpack</a> builder paketobuildpacks/builder:tiny to transform your source codes to a cloud native application(Docker image).</p><p>Simply run the following command to build the application into a Docker image.</p><pre>mvn clean package spring-boot:build-image</pre><p>The <a href="https://docs.spring.io/spring-native/docs/current/reference/htmlsingle/index.html#getting-started-native-image">Spring Native Reference</a> also introduced build native application through native image maven plugin.</p><p>Copy the source codes from <a href="https://github.com/hantsy/spring-reactive-sample/tree/master/boot-data-mongo-auditing">reactive mongo example</a> to this project, and refactor the pom.xml and introduce multiple maven profiles, and make it work with both cases.</p><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;<br>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>    &lt;parent&gt;<br>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br>        &lt;version&gt;2.4.4&lt;/version&gt;<br>        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;<br>    &lt;/parent&gt;<br>    &lt;groupId&gt;com.example&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-native-demo&lt;/artifactId&gt;<br>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br>    &lt;name&gt;demo&lt;/name&gt;<br>    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;<br>    &lt;properties&gt;<br>        &lt;java.version&gt;11&lt;/java.version&gt;<br>        &lt;spring-native.version&gt;0.9.1&lt;/spring-native.version&gt;<br>    &lt;/properties&gt;<br>    &lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;true&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;<br>            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;</pre><pre>    &lt;build&gt;<br>        &lt;plugins&gt;<br>            &lt;plugin&gt;<br>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br>                &lt;configuration&gt;<br>                    &lt;excludes&gt;<br>                        &lt;exclude&gt;<br>                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>                        &lt;/exclude&gt;<br>                    &lt;/excludes&gt;<br>                &lt;/configuration&gt;<br>            &lt;/plugin&gt;<br>        &lt;/plugins&gt;<br>    &lt;/build&gt;<br>    &lt;profiles&gt;<br>        &lt;profile&gt;<br>            &lt;id&gt;default&lt;/id&gt;<br>            &lt;activation&gt;<br>                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;<br>            &lt;/activation&gt;<br>            &lt;build&gt;<br>                &lt;plugins&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br>                        &lt;version&gt;3.0.0-M5&lt;/version&gt;<br>                        &lt;configuration&gt;<br>                            &lt;excludes&gt;<br>                                &lt;exclude&gt;**/FunctionalTests.*&lt;/exclude&gt;<br>                            &lt;/excludes&gt;<br>                        &lt;/configuration&gt;<br>                    &lt;/plugin&gt;<br>                &lt;/plugins&gt;<br>            &lt;/build&gt;<br>        &lt;/profile&gt;<br>        &lt;profile&gt;<br>            &lt;id&gt;spring-native&lt;/id&gt;<br>            &lt;dependencies&gt;<br>                &lt;dependency&gt;<br>                    &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt;<br>                    &lt;artifactId&gt;spring-native&lt;/artifactId&gt;<br>                    &lt;version&gt;${spring-native.version}&lt;/version&gt;<br>                &lt;/dependency&gt;<br>            &lt;/dependencies&gt;<br>            &lt;build&gt;<br>                &lt;plugins&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt;<br>                        &lt;artifactId&gt;spring-aot-maven-plugin&lt;/artifactId&gt;<br>                        &lt;version&gt;${spring-native.version}&lt;/version&gt;<br>                        &lt;executions&gt;<br>                            &lt;execution&gt;<br>                                &lt;id&gt;test-generate&lt;/id&gt;<br>                                &lt;goals&gt;<br>                                    &lt;goal&gt;test-generate&lt;/goal&gt;<br>                                &lt;/goals&gt;<br>                            &lt;/execution&gt;<br>                            &lt;execution&gt;<br>                                &lt;id&gt;generate&lt;/id&gt;<br>                                &lt;goals&gt;<br>                                    &lt;goal&gt;generate&lt;/goal&gt;<br>                                &lt;/goals&gt;<br>                            &lt;/execution&gt;<br>                        &lt;/executions&gt;<br>                    &lt;/plugin&gt;<br>                &lt;/plugins&gt;<br>            &lt;/build&gt;<br>        &lt;/profile&gt;<br>        &lt;profile&gt;<br>            &lt;id&gt;build-docker-image&lt;/id&gt;<br>            &lt;build&gt;<br>                &lt;plugins&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>                        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br>                        &lt;configuration&gt;<br>                            &lt;image&gt;<br>                                &lt;name&gt;hantsy/${project.artifactId}:latest&lt;/name&gt;<br>                                &lt;builder&gt;paketobuildpacks/builder:tiny&lt;/builder&gt;<br>                                &lt;env&gt;<br>                                    &lt;BP_NATIVE_IMAGE&gt;true&lt;/BP_NATIVE_IMAGE&gt;<br>                                &lt;/env&gt;<br>                            &lt;/image&gt;<br>                        &lt;/configuration&gt;<br>                    &lt;/plugin&gt;<br>                &lt;/plugins&gt;<br>            &lt;/build&gt;<br>        &lt;/profile&gt;<br>        &lt;profile&gt;<br>            &lt;id&gt;build-native-image&lt;/id&gt;<br>            &lt;build&gt;<br>                &lt;plugins&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>                        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br>                        &lt;configuration&gt;<br>                            &lt;classifier&gt;exec&lt;/classifier&gt;<br>                        &lt;/configuration&gt;<br>                    &lt;/plugin&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.graalvm.nativeimage&lt;/groupId&gt;<br>                        &lt;artifactId&gt;native-image-maven-plugin&lt;/artifactId&gt;<br>                        &lt;version&gt;21.0.0.2&lt;/version&gt;<br>                        &lt;configuration&gt;<br>                            &lt;!-- The native image build needs to know the entry point to your application --&gt;<br>                            &lt;mainClass&gt;com.example.demo.DemoApplication&lt;/mainClass&gt;<br>                        &lt;/configuration&gt;<br>                        &lt;executions&gt;<br>                            &lt;execution&gt;<br>                                &lt;goals&gt;<br>                                    &lt;goal&gt;native-image&lt;/goal&gt;<br>                                &lt;/goals&gt;<br>                                &lt;phase&gt;package&lt;/phase&gt;<br>                            &lt;/execution&gt;<br>                        &lt;/executions&gt;<br>                    &lt;/plugin&gt;</pre><pre>                &lt;/plugins&gt;<br>            &lt;/build&gt;<br>        &lt;/profile&gt;<br>        &lt;profile&gt;<br>            &lt;id&gt;functional-test&lt;/id&gt;<br>            &lt;build&gt;<br>                &lt;plugins&gt;<br>                    &lt;plugin&gt;<br>                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br>                        &lt;version&gt;3.0.0-M5&lt;/version&gt;<br>                        &lt;configuration&gt;<br>                            &lt;includes&gt;<br>                                &lt;include&gt;**/FunctionalTests.*&lt;/include&gt;<br>                            &lt;/includes&gt;<br>                        &lt;/configuration&gt;<br>                    &lt;/plugin&gt;<br>                &lt;/plugins&gt;<br>            &lt;/build&gt;<br>        &lt;/profile&gt;<br>    &lt;/profiles&gt;<br>    &lt;repositories&gt;<br>        &lt;repository&gt;<br>            &lt;id&gt;spring-releases&lt;/id&gt;<br>            &lt;name&gt;Spring Releases&lt;/name&gt;<br>            &lt;url&gt;https://repo.spring.io/release&lt;/url&gt;<br>        &lt;/repository&gt;<br>    &lt;/repositories&gt;<br>    &lt;pluginRepositories&gt;<br>        &lt;pluginRepository&gt;<br>            &lt;id&gt;spring-releases&lt;/id&gt;<br>            &lt;name&gt;Spring Releases&lt;/name&gt;<br>            &lt;url&gt;https://repo.spring.io/release&lt;/url&gt;<br>        &lt;/pluginRepository&gt;<br>    &lt;/pluginRepositories&gt;</pre><pre>&lt;/project&gt;</pre><p>By default, we do not contain any Spring native facilities that when run the application it works like a general Spring Boot application.</p><ul><li>The spring-native profile contains the build progress of AOT maven plugin.</li><li>The build-docker-image will build the application into a docker image via paketobuildpacks/builder:tiny builder.</li><li>The build-native-image will use GraalVM native image to build the application as system native executable.</li><li>The functional-test includes a simple FunctionalTests to verify if the application is working as expected from a client view.</li></ul><h3>Building with Paket BuildPacks</h3><p>The Paket BuildPacks requires docker environment, <a href="https://docs.docker.com/engine/install/">install it</a> firstly.</p><pre>mvn clean package spring-boot:build-image -Pspring-native,build-docker-image -DskipTests</pre><p>The application requires a running MongoDB at runtime. There is a <a href="https://github.com/hantsy/spring-native-example/blob/master/docker-compose.yml">docker-compose.yml</a> available to bootstrap a MongoDB service in seconds.</p><pre>docker-compose up mongodb</pre><p>Now run the application as any other Docker applications.</p><pre>docker run -rm hantsy/spring-native-demo</pre><h3>Building with Native Image maven plugin</h3><p>Make sure you have installed GraalVM firstly, follow the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a> guide to install it.</p><blockquote><em>Under Windows, GraalVM is still experimental. Consider installing it into a WSL2 system, and IDEA and VSCode have great WSL support.</em></blockquote><pre>mvn clean package spring-boot:build-image -Pspring-native,build-native-image -DskipTests</pre><p>When there is an executable file in the <em>target</em> folder. Note before running this command, make sure there is a running Mongo service.</p><pre>./target/com.example.demo.demoapplication</pre><p>You will feel the native application building progress is fairly slow and tedious, both way will consume a couple of minutes (not seconds), it is terrible at development stage for developers. I would like to move it to a CI(continuous integration) service to build it for you.</p><h3>Continuous Integrations</h3><p>I prepared <a href="https://github.com/hantsy/spring-native-example/tree/master/.github/workflows">3 Github actions workflow files</a> to build the project.</p><ul><li>build - build and run testing code like the general Spring Boot applications.</li><li>build-docker-image - build the application into a layered docker image via spring-boot:build-image goal, and start up the application and verify it using FunctionalTests mentioned above.</li><li>build-native-image - build the application into system native executable via GraalVM native image, and start up it and verify the functionality by running FunctionalTests.</li></ul><p>Ideally, when building Spring Native applications, we only need to focus on the development like building a general Spring Boot application, let CI to hand over the tedious work of building native applications.</p><p>But unfortunately, there are a lot of limitations in the current version, check the <a href="https://docs.spring.io/spring-native/docs/current/reference/htmlsingle/index.html#support">Support</a> section to get a check list of the supported features at the moment. To use those features are not in the support list, you could have to give up <em>Spring Native</em> and switch back to use JVM again.</p><blockquote><em>I also tried to enable Data Mongo auditing feature, it does not work on the native mode.</em></blockquote><h4><em>Grab a copy of the source codes from </em><a href="https://github.com/hantsy/spring-native-example/"><em>hantsy/spring-native-example</em></a><em> to experience yourself.</em></h4><h3>The Final Words</h3><p>Quarkus invents the Arc container which provides a subset of CDI APIs for developers, but integrally it produces static codes for beans at compile time instead of generating dynamic proxies at runtime.</p><p>In my opinion, I would like to see some similar mechanism in Spring Native that provides compile-time byte code enhancement to replace the Spring built-in dynamic proxies for beans, and make it as an alternative to the current Spring IOC container. Personally, I am a little disappointed.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=ae169136e544" width="1" height="1" alt=""><hr><p><a href="https://medium.com/geekculture/building-your-first-spring-native-application-ae169136e544">Building Your First Spring Native Application</a> was originally published in <a href="https://medium.com/geekculture">Geek Culture</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>

  </article>

  

</div>

  </div>

  <!-- Footer -->

  
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2022 Hantsy  Bai.
    <span class="mr-auto"></span>
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme.

    
    

  </div>
</footer>



</body>

<!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>


<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>





<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
