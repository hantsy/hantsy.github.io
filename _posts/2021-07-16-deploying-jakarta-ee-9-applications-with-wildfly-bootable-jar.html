---
layout: post
title: Deploying Jakarta EE 9 applications with WildFly Bootable JAR
---

<p>Since WildFly 21 was released, it is possible to build your application and the WildFly runtime into a single fat JAR file through the new wildfly-jar-maven-plugin . For developers, through this maven plugin, it brings the well-known Spring Boot building progress to Jakarta EE/WildFly world.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*9LvWuZ3Nwxhs4SaDBQ9viQ.jpeg" /><figcaption>Photo by <a href="https://unsplash.com/@robynnexy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Robynne Hu</a> on <a href="https://unsplash.com/s/photos/china-landscape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption></figure><h3>Prerequisites</h3><p>Make sure you have installed the following software.</p><ul><li>Java 11 , OpenJDK or <a href="https://adoptopenjdk.net/">AdoptOpenJDK</a></li><li>Apache Maven 3.6+</li><li><a href="https://www.wildfly.org">WildFly 24.0.0.Final</a>, please download the <em>Jakarta EE 9 preview</em> distribution</li><li><a href="https://docs.openshift.com/container-platform/4.2/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</a></li></ul><h3>Building a Bootable JAR</h3><p>Firstly add wildfly-jar-maven-plugin configuration.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-jar-maven-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-jar-maven-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;feature-pack-location&gt;<br>            wildfly-preview@maven(org.jboss.universe:community-universe)#${wildfly.version}<br>        &lt;/feature-pack-location&gt;<br>        &lt;layers&gt;<br>            &lt;layer&gt;jaxrs&lt;/layer&gt;<br>        &lt;/layers&gt;<br>        &lt;plugin-options&gt;<br>            &lt;jboss-fork-embedded&gt;true&lt;/jboss-fork-embedded&gt;<br>        &lt;/plugin-options&gt;<br>    &lt;/configuration&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;package&lt;/goal&gt;<br>            &lt;/goals&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;</pre><p>The <em>feature-pack-location</em> defines the infrastructure feature it will be used to build the application, and <em>layers</em> specifies which layers will be activated</p><blockquote><em>More details about layers, please refer to the bootable jar documentation and read the </em><a href="https://docs.wildfly.org/bootablejar/#wildfly_jar_composing_custom_server_galleon"><em>Galleon layers</em></a><em> chapter.</em></blockquote><blockquote><em>In the feature pack, we use </em><em>wildfly-preview to use the Jakarta EE 9 preview.</em></blockquote><p>Run the following command to build the application.</p><pre>mvn clean package -Pwildfly-bootable</pre><p>Besides the generic <em>war</em> package built by maven war plugin, there is another jar file with <em>-bootable.jar</em> postfix is built by wildfly-jar-maven-plugin.</p><p>Run the following command to start application.</p><pre>java -jar target\jakartaee9-starter-boilerplate-bootable.jar</pre><p>Use curl command to test the sample endpoint.</p><pre>curl -v <a href="http://localhost:8080/api/greeting/JakartaEE">http://localhost:8080/api/greeting/JakartaEE</a></pre><blockquote><em>Note, in the bootable jar, by default it sets the application context path to root(“/”).</em></blockquote><h3>Deploying to OpenShift</h3><p>The wildfly-jar-maven-plugin provides out-of-box cloud support. You can use it together with openshift-maven-plugin and build application into docker image from source codes and deploy to the OpenShift cluster.</p><p>There are several options to use OpenShift, check <a href="https://www.openshift.com">the official website</a> for details.</p><p>The simplest way is registering RedHat hosted OpenShift cloud, it provides a free <em>Developer sandbox</em> plan. Once you have registered, it will provide you an interactive Web UI for developers and administrators views.</p><p>To use openshift-maven-plugin , you have to login firstly. In the OpenShift home page, click the <em>question(?)</em> icon button in the top right area, and click the <em>command line tools</em> menu item. Copy the <em>oc login command line</em> in the opened page. More details, please refer to <a href="https://developers.redhat.com/blog/2021/04/21/access-your-developer-sandbox-for-red-hat-openshift-from-the-command-line#">this guide</a>.</p><p>Assume you have installed <a href="https://docs.openshift.com/container-platform/4.2/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</a>, open a terminal, paste the command to login into the OpenShift cloud.</p><pre>oc login ...</pre><p>Next let’s configure the wildfly-jar-maven-plugin and openshift-maven-plugin.</p><pre>&lt;properties&gt;<br>    &lt;jkube.generator.from&gt;registry.redhat.io/ubi8/openjdk-11:latest&lt;/jkube.generator.from&gt;<br>&lt;/properties&gt;<br>&lt;build&gt;<br>    &lt;plugins&gt;<br>        &lt;plugin&gt;<br>            &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;<br>            &lt;artifactId&gt;wildfly-jar-maven-plugin&lt;/artifactId&gt;<br>            &lt;version&gt;${wildfly-jar-maven-plugin.version}&lt;/version&gt;<br>            &lt;configuration&gt;<br>                &lt;feature-pack-location&gt;<br>                    wildfly-preview@maven(org.jboss.universe:community-universe)#${wildfly.version}<br>                &lt;/feature-pack-location&gt;<br>                &lt;layers&gt;<br>                    &lt;layer&gt;cloud-server&lt;/layer&gt;<br>                &lt;/layers&gt;<br>                &lt;excluded-layers&gt;<br>                    &lt;layer&gt;deployment-scanner&lt;/layer&gt;<br>                &lt;/excluded-layers&gt;<br>                &lt;cloud/&gt;<br>                &lt;plugin-options&gt;<br>                    &lt;jboss-fork-embedded&gt;true&lt;/jboss-fork-embedded&gt;<br>                &lt;/plugin-options&gt;<br>            &lt;/configuration&gt;<br>            &lt;executions&gt;<br>                &lt;execution&gt;<br>                    &lt;goals&gt;<br>                        &lt;goal&gt;package&lt;/goal&gt;<br>                    &lt;/goals&gt;<br>                &lt;/execution&gt;<br>            &lt;/executions&gt;<br>        &lt;/plugin&gt;<br>        &lt;plugin&gt;<br>            &lt;groupId&gt;org.eclipse.jkube&lt;/groupId&gt;<br>            &lt;artifactId&gt;openshift-maven-plugin&lt;/artifactId&gt;<br>            &lt;version&gt;${openshift-maven-plugin.version}&lt;/version&gt;<br>            &lt;executions&gt;<br>                &lt;execution&gt;<br>                    &lt;goals&gt;<br>                        &lt;goal&gt;resource&lt;/goal&gt;<br>                        &lt;goal&gt;build&lt;/goal&gt;<br>                    &lt;/goals&gt;<br>                &lt;/execution&gt;<br>            &lt;/executions&gt;<br>            &lt;configuration&gt;<br>                &lt;enricher&gt;<br>                    &lt;config&gt;<br>                        &lt;jkube-service&gt;<br>                            &lt;type&gt;NodePort&lt;/type&gt;<br>                        &lt;/jkube-service&gt;<br>                    &lt;/config&gt;<br>                &lt;/enricher&gt;<br>            &lt;/configuration&gt;<br>        &lt;/plugin&gt;<br>    &lt;/plugins&gt;<br>&lt;/build&gt;</pre><p>Here we use a <em>cloud-server</em> layer instead of the former <em>jaxrs</em>, and add another openshift-maven-plugin configuration.</p><blockquote><em>More details about the OpenShift maven plugin, see </em><a href="https://www.eclipse.org/jkube/docs/openshift-maven-plugin"><em>Eclipse JKube documentation</em></a><em>.</em></blockquote><p>Run the following command to deploy application to OpenShift cloud.</p><pre>mvn clean oc:deploy -Pwildfly-openshift</pre><p>After it is done, you can watch the pod nodes via the following command.</p><pre>oc get pods -w</pre><p>Go to the OpenShift Web UI, and click the <em>Project</em> in the left pane, then you can see all related resources, including Pod Nodes, Services, Routes, etc.</p><p>Click <em>Pods</em>, and select <em>jakartaee9-starter-boilerplate-1-xxxxx</em>, then switch to <em>Terminal</em> tab, try to use curl to check our application is working well.</p><pre>curl -v <a href="http://localhost:8080/api/greeting/JakartaEE">http://localhost:8080/api/greeting/JakartaEE</a></pre><p>The result is similar to the following screen.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*UcdDwa6Y_-jf1s4I.png" /></figure><p>Go back to <em>Project</em> view, and click <em>Routes</em>, and select <em>jakartaee9-starter-boilerplate</em>. In the detail page, you can find the external URL of this deployed application(or you can get it via the following command).</p><p>Try to access the sample API endpoint through the external URL.</p><pre>$ oc get route jakartaee9-starter-boilerplate -o jsonpath=&quot;{.spec.host}&quot;<br>jakartaee9-starter-boilerplate-hantsy-dev.apps.sandbox-m2.ll9k.p1.openshiftapps.com</pre><pre>$ curl -v <a href="http://jakartaee9-starter-boilerplate-hantsy-dev.apps.sandbox-m2.ll9k.p1.openshiftapps.com/api/greeting/JakartaEE">http://jakartaee9-starter-boilerplate-hantsy-dev.apps.sandbox-m2.ll9k.p1.openshiftapps.com/api/greeting/JakartaEE</a></pre><pre>&gt; GET /api/greeting/JakartaEE HTTP/1.1<br>&gt; Host: jakartaee9-starter-boilerplate-hantsy-dev.apps.sandbox-m2.ll9k.p1.openshiftapps.com<br>&gt; User-Agent: curl/7.55.1<br>&gt; Accept: */*<br>&gt;<br>&lt; HTTP/1.1 200 OK<br>&lt; content-type: application/json<br>&lt; content-length: 66<br>&lt; date: Thu, 15 Jul 2021 14:02:46 GMT<br>&lt; set-cookie: 8f1aeb5fdab055810cd99f63982ad17b=1540c81cbcc1728a7c020191c74f5fa7; path=/; HttpOnly<br>&lt; cache-control: private<br>&lt;<br>{&quot;message&quot;:&quot;Say Hello to JakartaEE at 2021-07-15T14:02:46.571707&quot;}</pre><h3>Running Arquillian Tests against Bootable JAR</h3><p>As mentioned in <a href="https://itnext.io/testing-jakarta-ee-9-applications-with-arquillian-and-wildfly-cd108eec57e2">the last post</a>, WildFly Arqullian project includes a <em>bootable</em> container adapter for testing against the bootable jar.</p><p>Add the following dependency in the project <em>pom.xml</em> file.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;org.wildfly.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-arquillian-container-bootable&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-arquillian.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>// jerseys are omitted.</pre><p>Add wildfly-jar-maven-plugin to build a <em>bootable</em> fat JAR for testing purpose.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-jar-maven-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-jar-maven-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;feature-pack-location&gt;<br>            wildfly-preview@maven(org.jboss.universe:community-universe)#${wildfly.version}<br>        &lt;/feature-pack-location&gt;<br>        &lt;layers&gt;<br>            &lt;layer&gt;jaxrs&lt;/layer&gt;<br>            &lt;layer&gt;management&lt;/layer&gt;<br>        &lt;/layers&gt;<br>        &lt;excluded-layers&gt;<br>            &lt;layer&gt;deployment-scanner&lt;/layer&gt;<br>        &lt;/excluded-layers&gt;<br>        &lt;plugin-options&gt;<br>            &lt;jboss-fork-embedded&gt;true&lt;/jboss-fork-embedded&gt;<br>        &lt;/plugin-options&gt;<br>    &lt;/configuration&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;package&lt;/goal&gt;<br>            &lt;/goals&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;</pre><p>Create a new <em>container</em> in the <em>arquillian.xml</em> for this adapter.</p><pre>&lt;container qualifier=&quot;wildfly-bootable-jar&quot; default=&quot;true&quot;&gt;<br>    &lt;configuration&gt;<br>        &lt;property name=&quot;jarFile&quot;&gt;${bootable.jar}&lt;/property&gt;<br>        &lt;property name=&quot;allowConnectingToRunningServer&quot;&gt;false&lt;/property&gt;<br>        &lt;property name=&quot;managementAddress&quot;&gt;127.0.0.1&lt;/property&gt;<br>        &lt;property name=&quot;managementPort&quot;&gt;9990&lt;/property&gt;<br>        &lt;property name=&quot;waitForPorts&quot;&gt;9990&lt;/property&gt;<br>        &lt;property name=&quot;waitForPortsTimeoutInSeconds&quot;&gt;8&lt;/property&gt;<br>    &lt;/configuration&gt;<br>&lt;/container&gt;</pre><p>Define a system wide property <em>bootable.jar</em> in the configuration of maven failsafe plugin .</p><pre>&lt;plugin&gt;<br>     &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br>     &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br>     &lt;configuration&gt;<br>         &lt;systemPropertyVariables&gt;<br>             &lt;bootable.jar&gt;${project.build.directory}/${project.artifactId}-bootable.jar<br>             &lt;/bootable.jar&gt;<br>             &lt;arquillian.launch&gt;wildfly-bootable-jar&lt;/arquillian.launch&gt;<br>             &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;<br>         &lt;/systemPropertyVariables&gt;<br>     &lt;/configuration&gt;<br>&lt;/plugin&gt;</pre><p>Now run the tests using the following command.</p><pre>mvn clean verify -Parq-wildfly-bootable-jar</pre><p>Grab the <a href="https://github.com/hantsy/jakartaee9-starter-boilerplate">example codes from my Github</a>.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=a6cd436da7ea" width="1" height="1" alt=""><hr><p><a href="https://medium.com/geekculture/deploying-jakarta-ee-9-applications-with-wildfly-bootable-jar-a6cd436da7ea">Deploying Jakarta EE 9 applications with WildFly Bootable JAR</a> was originally published in <a href="https://medium.com/geekculture">Geek Culture</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
