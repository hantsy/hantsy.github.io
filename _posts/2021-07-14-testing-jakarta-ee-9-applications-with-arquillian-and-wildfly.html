---
layout: post
title: Testing Jakarta EE 9 Applications with Arquillian and WildFly
---

<p>With the long-awaited <a href="https://issues.redhat.com/projects/WFARQ/issues/WFARQ-89">Jakarta EE 9 support</a> issue was fixed in the newest 5.0.0.Alpha1 version of <a href="https://github.com/wildfly/wildfly-arquillian">WildFly Arquillian project</a>, finally we can test Jakarta EE 9 applications against WildFly application server with the newest Arquillian adapters.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*lgjXQLt2VoM5VAQAcb47IA.jpeg" /><figcaption>Photo by <a href="https://unsplash.com/@nelmin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Evgeny Nelmin</a> on <a href="https://unsplash.com/s/photos/china-landscape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption></figure><p>In this post, we will explore testing Jakarta EE 9 application with various WildFly Arquillian adapters.</p><ul><li><em>WildFly Arquillian Managed Container</em>, in this case the Arquillian controller is responsible for starting and stopping the WildFly server via administrative tools.</li><li><em>WildFly Arquillian Remote Container</em>, Arquillian does not start and stop the WildFly server, it deploys the test archive to a running WildFly server through available remote protocols, such as HTTP, JMX etc.</li><li><em>WildFly Arquillian Embedded Container</em>, similar to the managed adapter, but embedded adapter controls the WildFly server via embedded WildFly APIs, generally the test itself and the server would run on the same thread.</li><li><em>WildFly Arquillian Managed Domain Container</em>, use a single domain instead of the standalone server.</li><li><em>WildFly Arquillian Remote Domain Container</em>, use a single domain instead of the standalone server.</li><li><em>WildFly Arquillian Bootable JAR Container</em>, it deploys the test archive on the bootable JAR built by maven bootable jar plugin.</li></ul><p>Here we focus on the first three adapters.</p><h3>Prerequisites</h3><ul><li>Java 11 (<a href="https://openjdk.java.net/install/">OpenJDK</a> or <a href="https://adoptopenjdk.net/installation.html">AdoptOpenJDK</a>)</li><li>The latest <a href="http://maven.apache.org/download.cgi">Apache Maven</a></li><li>The basic knowledge of <a href="https://junit.org/junit5/">JUnit 5</a></li><li>Get to know <a href="http://arquillian.org/guides/">the basic of Arquillian</a></li><li>Download a copy of <a href="https://www.wildfly.org">WildFly</a> server, please download the <em>Jakarta EE 9 tech preview</em> version.</li></ul><h3>Code Examples</h3><p>Get <a href="https://github.com/hantsy/jakartaee9-starter-boilerplate">the source codes from my Github</a>, and read <a href="https://hantsy.github.io/jakartaee9-starter-boilerplate/">the docs</a> to understand the project structure and the existing source codes. We will focus on the Arquillian configurations for these WildFly adapters.</p><h3>Configuring WildFly Managed Container Adapter</h3><p>Add the following dependencies into your project, the Jersey related dependencies are used for test RESTful APIs using <em>JAXRS Client</em> API. WildFly includes its built-in JAXRS implementation — RESTEasy(maybe transformed by Jakarta EE 9 migration tools), but currently there is no public official RESTEasy versions released for Jakarta EE 9.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;org.glassfish.jersey.media&lt;/groupId&gt;<br>    &lt;artifactId&gt;jersey-media-json-binding&lt;/artifactId&gt;<br>    &lt;version&gt;${jersey.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.glassfish.jersey.inject&lt;/groupId&gt;<br>    &lt;artifactId&gt;jersey-hk2&lt;/artifactId&gt;<br>    &lt;version&gt;${jersey.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.glassfish.jersey.core&lt;/groupId&gt;<br>    &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;<br>    &lt;version&gt;${jersey.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.wildfly.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-arquillian-container-managed&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-arquillian.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><p>Create a container configuration in the <em>arquillian.xml</em> file.</p><pre>&lt;container qualifier=&quot;wildfly-managed&quot;&gt;<br>    &lt;configuration&gt;<br>        &lt;!--&lt;property name=&quot;jbossHome&quot;&gt;${jbossHome:target/wildfly-18.0.1.Final}&lt;/property&gt;--&gt;<br>        &lt;property name=&quot;serverConfig&quot;&gt;standalone-full.xml&lt;/property&gt;<br>    &lt;/configuration&gt;<br>&lt;/container&gt;</pre><p>You can define a jbossHome property in the <em>arquillian.xml</em> file to specify the location of the existing WildFly server in your local system.</p><p>Alternatively, to get a clean environment to run your tests every time, you can configure a <strong>Dependency Maven Plugin</strong> to download a copy of WildFly, and use it to run your tests. This is a great option to run the tests continuously in your CI servers.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;id&gt;unpack&lt;/id&gt;<br>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;unpack&lt;/goal&gt;<br>            &lt;/goals&gt;<br>            &lt;configuration&gt;<br>                &lt;artifactItems&gt;<br>                    &lt;artifactItem&gt;<br>                        &lt;groupId&gt;org.wildfly&lt;/groupId&gt;<br>                        &lt;artifactId&gt;wildfly-preview-dist&lt;/artifactId&gt;<br>                        &lt;version&gt;${wildfly.version}&lt;/version&gt;<br>                        &lt;type&gt;zip&lt;/type&gt;<br>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br>                    &lt;/artifactItem&gt;<br>                &lt;/artifactItems&gt;<br>            &lt;/configuration&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;environmentVariables&gt;<br>            &lt;JBOSS_HOME&gt;${project.build.directory}/wildfly-preview-${wildfly.version}&lt;/JBOSS_HOME&gt;<br>        &lt;/environmentVariables&gt;<br>        &lt;systemPropertyVariables&gt;<br>            &lt;arquillian.launch&gt;wildfly-managed&lt;/arquillian.launch&gt;<br>            &lt;serverConfig&gt;standalone-full.xml&lt;/serverConfig&gt;<br>            &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;<br>        &lt;/systemPropertyVariables&gt;<br>    &lt;/configuration&gt;<br>&lt;/plugin&gt;</pre><blockquote><em>Note: we use </em><em>wildfly-preview-dist artifactId here to download the WildFly Jakarta EE 9 preview version.</em></blockquote><p>Open your terminal and witch to the project root folder.</p><p>Run the following command to run the tests against WildFly server.</p><pre>mvn clean verify -Parq-wildfly-managed</pre><h3>Configuring WildFly Remote Container Adapter</h3><p>With Arquillian WildFly Remote Container adapter, you can run the tests against a running WildFly server, esp. it is running on a different host.</p><p>Adding the following wildfly-arquillian-container-remote dependency instead.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;org.wildfly.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-arquillian-container-remote&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-arquillian.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>// the jersey client depdenceies are omitted.</pre><p>And add a <em>container</em> section in the <em>arquillian.xml</em> file for this remote container, and configure the essential properties, such as username, password, protocoletc.</p><pre>&lt;container qualifier=&quot;wildfly-remote&quot;&gt;<br>    &lt;configuration&gt;<br>        &lt;property name=&quot;managementAddress&quot;&gt;127.0.0.1&lt;/property&gt;<br>        &lt;property name=&quot;managementPort&quot;&gt;9990&lt;/property&gt;<br>        &lt;property name=&quot;protocol&quot;&gt;http-remoting&lt;/property&gt;<br>        &lt;property name=&quot;username&quot;&gt;admin&lt;/property&gt;<br>        &lt;property name=&quot;password&quot;&gt;Admin@123&lt;/property&gt;<br>    &lt;/configuration&gt;<br>&lt;/container&gt;</pre><p>Before executing the tests, setup a admin user configured in the above codes. Go to the WildFly installation folder, run the following command to enable the user <em>admin</em>.</p><pre>&lt;WF_HOME&gt;/bin/add-user.sh admin Admin@123 --silent</pre><p>And make sure the target WildFly server is running.</p><p>Execute the following command to run tests against the running WildFly server.</p><pre>mvn clean verfiy -Parq-wildfly-managed</pre><h3>Configuring WildFly Embedded Container Adapter</h3><p>The configuration of the WildFly embedded adapter is similar to the WildFly managed adapter.</p><p>Adding the following wildfly-arquillian-container-embedded dependency instead.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;org.wildfly.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;wildfly-arquillian-container-embedded&lt;/artifactId&gt;<br>    &lt;version&gt;${wildfly-arquillian.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>// the jersey client depdenceies are omitted.</pre><p>Configure a containerfor this WildFly Embedded adapter in the <em>arquillian.xml</em> file.</p><pre>&lt;container qualifier=&quot;wildfly-embedded&quot;&gt;<br>    &lt;configuration&gt;<br>        &lt;!--&lt;property name=&quot;jbossHome&quot;&gt;${jbossHome:target/wildfly-18.0.1.Final}&lt;/property&gt;--&gt;<br>        &lt;property name=&quot;serverConfig&quot;&gt;standalone-full.xml&lt;/property&gt;<br>    &lt;/configuration&gt;<br>&lt;/container&gt;</pre><p>Similarly, use maven dependency plugin to download a copy of WildFly dist as the runtime server.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;id&gt;unpack&lt;/id&gt;<br>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;unpack&lt;/goal&gt;<br>            &lt;/goals&gt;<br>            &lt;configuration&gt;<br>                &lt;artifactItems&gt;<br>                    &lt;artifactItem&gt;<br>                        &lt;groupId&gt;org.wildfly&lt;/groupId&gt;<br>                        &lt;artifactId&gt;wildfly-preview-dist&lt;/artifactId&gt;<br>                        &lt;version&gt;${wildfly.version}&lt;/version&gt;<br>                        &lt;type&gt;zip&lt;/type&gt;<br>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br>                    &lt;/artifactItem&gt;<br>                &lt;/artifactItems&gt;<br>            &lt;/configuration&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;environmentVariables&gt;<br>            &lt;JBOSS_HOME&gt;${project.build.directory}/wildfly-preview-${wildfly.version}&lt;/JBOSS_HOME&gt;<br>        &lt;/environmentVariables&gt;<br>        &lt;systemPropertyVariables&gt;<br>            &lt;arquillian.launch&gt;wildfly-embedded&lt;/arquillian.launch&gt;<br>            &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;<br>        &lt;/systemPropertyVariables&gt;<br>    &lt;/configuration&gt;<br>&lt;/plugin&gt;</pre><p>Run tests against WildFly Embedded adapter.</p><pre>mvn clean verfiy -Parq-wildfly-embedded</pre><h4>Grab a copy of <a href="https://github.com/hantsy/jakartaee9-starter-boilerplate">the source codes from my Github</a>, and explore them yourself.</h4><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=cd108eec57e2" width="1" height="1" alt=""><hr><p><a href="https://itnext.io/testing-jakarta-ee-9-applications-with-arquillian-and-wildfly-cd108eec57e2">Testing Jakarta EE 9 Applications with Arquillian and WildFly</a> was originally published in <a href="https://itnext.io">ITNEXT</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
