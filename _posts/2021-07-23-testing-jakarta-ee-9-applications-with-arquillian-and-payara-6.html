---
layout: post
title: Testing Jakarta EE 9 Applications with Arquillian and Payara 6
---

<p>In the latest stable Payara 5, it added the early Jakarta EE 9 support. Payara 6.2021.Alpha1 brought full Jakarta EE 9/9.1 support by default. As <a href="https://github.com/payara/ecosystem-support/issues/28">Arquillian support for Payara 6 issue</a> was fixed, testing Jakarta EE 9 applications against Payara servers is available.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*CEAbGIiTXGzYMRZfy4JHOA.jpeg" /><figcaption>Photo by <a href="https://unsplash.com/@ideasboom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Qingbao Meng</a> on <a href="https://unsplash.com/s/photos/china-landscape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption></figure><p>Payara Arquillian project provides several Arquillian Container adapters for Payara Server.</p><ul><li>Payara Managed Container Adapter</li><li>Payara Remote Container Adapter</li><li>Payara Embedded Container Adapter</li><li>Payara Micro Managed Container Adapter</li></ul><h3>Example Codes</h3><p>The <a href="https://github.com/hantsy/jakartaee9-starter-boilerplate">example codes</a> are shared via my Github. The Arquillian configuration for these 4 adapters are provided via 4 Maven profiles.</p><h3>Prerequisites</h3><ul><li>Java 11 (<a href="https://openjdk.java.net/install/">OpenJDK</a> or <a href="https://adoptopenjdk.net/installation.html">AdoptOpenJDK</a>)</li><li>The latest <a href="http://maven.apache.org/download.cgi">Apache Maven</a></li><li>The basic knowledge of <a href="https://junit.org/junit5/">JUnit 5</a></li><li>Get to know <a href="http://arquillian.org/guides/">the basic of Arquillian</a></li></ul><h3>Configuring Payara Managed Container Adapter</h3><p>Add arquillian-payara-server-managed dependency into your project.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;!-- Payara Server Container adaptor --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;arquillian-payara-server-managed&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><p>Create a container configuration in the <em>arquillian.xml</em> file.</p><pre>&lt;container qualifier=&quot;payara-managed&quot;&gt;<br>    &lt;configuration&gt;<br>        &lt;property name=&quot;allowConnectingToRunningServer&quot;&gt;false&lt;/property&gt;<br>        &lt;property name=&quot;adminHost&quot;&gt;localhost&lt;/property&gt;<br>        &lt;property name=&quot;adminPort&quot;&gt;4848&lt;/property&gt;<br>        &lt;property name=&quot;enableH2&quot;&gt;${enableDerby:true}&lt;/property&gt;<br>        &lt;property name=&quot;outputToConsole&quot;&gt;true&lt;/property&gt;<br>    &lt;/configuration&gt;<br>&lt;/container&gt;</pre><p>Configure maven-dependency-plugin to download a copy of Payara distribution, and use it to run your tests. This is a great option to run the tests continuously in your CI servers.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;id&gt;unpack&lt;/id&gt;<br>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;unpack&lt;/goal&gt;<br>            &lt;/goals&gt;<br>            &lt;configuration&gt;<br>                &lt;artifactItems&gt;<br>                    &lt;artifactItem&gt;<br>                        &lt;groupId&gt;fish.payara.distributions&lt;/groupId&gt;<br>                        &lt;artifactId&gt;payara&lt;/artifactId&gt;<br>                        &lt;version&gt;${payara.version}&lt;/version&gt;<br>                        &lt;type&gt;zip&lt;/type&gt;<br>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br>                    &lt;/artifactItem&gt;<br>                &lt;/artifactItems&gt;<br>            &lt;/configuration&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;systemPropertyVariables&gt;<br>            &lt;payara.home&gt;${project.build.directory}/payara6&lt;/payara.home&gt;<br>            &lt;arquillian.launch&gt;payara-managed&lt;/arquillian.launch&gt;<br>        &lt;/systemPropertyVariables&gt;<br>    &lt;/configuration&gt;<br>&lt;/plugin&gt;</pre><p>Run the following command to run the tests.</p><pre>mvn clean verify -Parq-payara-managed</pre><p>In this case, Arquillian is responsible for starting and stopping the Payara container.</p><h3>Configuring Payara Remote Container Adapter</h3><p>With Arquillian Payara remote container, you can run the tests against a running Payara server, esp. it is running on a different host.</p><p>Adding the following arquillian-payara-server-remote dependency instead.</p><pre>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;arquillian-payara-server-remote&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><p>And add a <em>container</em> section in the <em>arquillian.xml</em> file for this remote container, and configure the adminHost adminPort, adminUser , adminPassword if they are different from the default value.</p><pre>&lt;container qualifier=&quot;payara-remote&quot;&gt;<br>        &lt;configuration&gt;<br>            &lt;property name=&quot;adminHost&quot;&gt;localhost&lt;/property&gt;<br>            &lt;property name=&quot;adminPort&quot;&gt;4848&lt;/property&gt;<br>            &lt;property name=&quot;adminUser&quot;&gt;admin&lt;/property&gt;<br>            &lt;!-- if https is enabled via `asadmin enable-secure-admin` on a remote server --&gt;<br>            &lt;!-- &lt;property name=&quot;adminHttps&quot;&gt;true&lt;/property&gt;--&gt;<br>            &lt;!-- if admin password is changed via `asadmin change-admin-password` --&gt;<br>            &lt;!--&lt;property name=&quot;adminPassword&quot;&gt;adminadmin&lt;/property&gt;--&gt;<br>            &lt;!-- default is empty --&gt;<br>            &lt;property name=&quot;adminPassword&quot;&gt;&lt;/property&gt;<br>        &lt;/configuration&gt;<br>    &lt;/container&gt;</pre><p>Before executing the tests, make sure the target Payara server is running.</p><p>Run the following command to run tests against the running Payara server.</p><pre>mvn clean verfiy -Parq-payara-managed</pre><h3>Configuring Payara Embedded Container Adapter</h3><p>With the Payara embedded container adapter, you can run tests on an embedded Payara server.</p><p>Add the following dependency into your project.</p><pre>&lt;dependency&gt;<br>     &lt;groupId&gt;fish.payara.extras&lt;/groupId&gt;<br>     &lt;artifactId&gt;payara-embedded-all&lt;/artifactId&gt;<br>     &lt;version&gt;${payara.version}&lt;/version&gt;<br>     &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;arquillian-payara-server-embedded&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><p>Then run the following command to run tests.</p><pre>mvn clean verfiy -Parq-payara-embdded</pre><h3>Configuring Payara Micro Managed Container Adapter</h3><p>With the Payara Micro managed container adapter, you can run tests on an Payara Micro fat JAR.</p><p>Add the following dependency into your project.</p><pre>&lt;dependency&gt;<br>      &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>      &lt;artifactId&gt;payara-client-ee9&lt;/artifactId&gt;<br>      &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>      &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><pre>&lt;!-- Payara Micro Managed Container Adaptor --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;<br>    &lt;artifactId&gt;arquillian-payara-micro-managed&lt;/artifactId&gt;<br>    &lt;version&gt;${arquillian-payara.version}&lt;/version&gt;<br>    &lt;scope&gt;test&lt;/scope&gt;<br>&lt;/dependency&gt;</pre><p>Download a copy of Payara Micro via maven dependency plugin, and set a system property payara.microJar to point to the location of the downloaded Payara Micro JAR.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;id&gt;unpack&lt;/id&gt;<br>            &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;copy&lt;/goal&gt;<br>            &lt;/goals&gt;<br>            &lt;configuration&gt;<br>                &lt;artifactItems&gt;<br>                    &lt;artifactItem&gt;<br>                        &lt;groupId&gt;fish.payara.extras&lt;/groupId&gt;<br>                        &lt;artifactId&gt;payara-micro&lt;/artifactId&gt;<br>                        &lt;version&gt;${payara.version}&lt;/version&gt;<br>                        &lt;type&gt;jar&lt;/type&gt;<br>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br>                        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;<br>                        &lt;destFileName&gt;payara-micro.jar&lt;/destFileName&gt;<br>                    &lt;/artifactItem&gt;<br>                &lt;/artifactItems&gt;<br>            &lt;/configuration&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-failsafe-plugin.version}&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;systemPropertyVariables&gt;<br>            &lt;payara.microJar&gt;${project.build.directory}/payara-micro.jar&lt;/payara.microJar&gt;<br>        &lt;/systemPropertyVariables&gt;<br>    &lt;/configuration&gt;<br>&lt;/plugin&gt;</pre><p>Then run the following command to run tests.</p><pre>mvn clean verfiy -Parq-payara-micro</pre><p>Get <a href="https://github.com/hantsy/jakartaee9-starter-boilerplate">the source codes from my Github</a>.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=52fd153d8d9" width="1" height="1" alt="">
