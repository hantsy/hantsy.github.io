---
layout: post
title: Jakarta REST 3.1 by Examples
---

<p>Jakarta REST includes a dozen of small improvements, and also introduces two major new features.</p><ul><li>Java SE Bootstrap API</li><li>The long-awaited standard Multipart API</li></ul><p>Let’s explore these features by examples.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Anj-VcomDtdChNasGbaoSQ.jpeg" /></figure><h3>Bootstrap API</h3><p>Like the CDI Bootstrap API to host a CDI container in Java SE environment, Jakarta REST Bootstrap API provides similar API to serve a Jaxrs application in embedded servers.</p><h3>Creating Java SE Project</h3><p>Follow the steps in the <a href="https://github.com/hantsy/jakartaee10-sandbox/blob/master/docs/jpa/hibernate.md">Jakarta Persistence — Example: Hibernate 6.1</a> to create a simple Java SE project.</p><p>We will use sl4j/logback as logging framework, and also use Lombok annotations to simplify the Java codes.</p><p>Add the following dependencies in the project <em>pom.xml</em>.</p><pre>&lt;!-- Lombok --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>    &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>    &lt;optional&gt;true&lt;/optional&gt;<br>    &lt;version&gt;1.18.24&lt;/version&gt;<br>&lt;/dependency&gt;</pre><pre>&lt;!-- logging with logback --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br>    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;<br>    &lt;version&gt;2.0.4&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br>    &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;<br>    &lt;version&gt;2.0.4&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br>    &lt;artifactId&gt;logback-core&lt;/artifactId&gt;<br>    &lt;version&gt;1.4.4&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br>    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br>    &lt;version&gt;1.4.4&lt;/version&gt;<br>&lt;/dependency&gt;</pre><p>Create <em>src/main/resources/logback.xml</em> to set up Logback.</p><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;configuration&gt;<br> &lt;property name=&quot;LOGS&quot; value=&quot;./logs&quot;/&gt;<br>&lt;appender name=&quot;Console&quot;<br>              class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;<br>        &lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;<br>            &lt;Pattern&gt;<br>                %green(%d{ISO8601}) %highlight(%-5level) [%blue(%t)] %yellow(%C{1.}): %msg%n%throwable<br>            &lt;/Pattern&gt;<br>        &lt;/layout&gt;<br>    &lt;/appender&gt;<br>    &lt;appender name=&quot;RollingFile&quot;<br>              class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>        &lt;file&gt;${LOGS}/app.log&lt;/file&gt;<br>        &lt;encoder<br>                class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;<br>            &lt;Pattern&gt;%d %p %C{1.} [%t] %m%n&lt;/Pattern&gt;<br>        &lt;/encoder&gt;<br>        &lt;rollingPolicy<br>                class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>            &lt;!-- rollover daily and when the file reaches 10 MegaBytes --&gt;<br>            &lt;fileNamePattern&gt;${LOGS}/archived/app-%d{yyyy-MM-dd}.%i.log<br>            &lt;/fileNamePattern&gt;<br>            &lt;timeBasedFileNamingAndTriggeringPolicy<br>                    class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;&gt;<br>                &lt;maxFileSize&gt;10MB&lt;/maxFileSize&gt;<br>            &lt;/timeBasedFileNamingAndTriggeringPolicy&gt;<br>        &lt;/rollingPolicy&gt;<br>    &lt;/appender&gt;<br>    &lt;!-- LOG everything at INFO level --&gt;<br>    &lt;root level=&quot;info&quot;&gt;<br>        &lt;appender-ref ref=&quot;RollingFile&quot;/&gt;<br>        &lt;appender-ref ref=&quot;Console&quot;/&gt;<br>    &lt;/root&gt;<br>    &lt;logger name=&quot;org.glassfish.jersey.server&quot; level=&quot;DEBUG&quot;&gt;<br>    &lt;/logger&gt;<br>    &lt;logger name=&quot;com.example&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;<br>        &lt;appender-ref ref=&quot;RollingFile&quot;/&gt;<br>        &lt;appender-ref ref=&quot;Console&quot;/&gt;<br>    &lt;/logger&gt;<br>&lt;/configuration&gt;</pre><p>Add the Jakarta REST API into the dependencies.</p><pre>&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;<br>        &lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;<br>        &lt;version&gt;3.1.0&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    //...<br>&lt;/dependencies&gt;</pre><p>Create a <em>main</em> class as the application entry.</p><pre>@Slf4j<br>public class Main {<br>public static void main(String[] args) throws InterruptedException, IOException {<br>        SeBootstrap.Configuration configuration = SeBootstrap.Configuration.builder()<br>                .host(&quot;localhost&quot;)<br>                .port(8080)<br>                .protocol(&quot;http&quot;)<br>                .build();<br>        SeBootstrap.start(RestConfig.class, configuration)<br>            .thenAccept(instance -&gt; {<br>                    instance.stopOnShutdown(stopResult -&gt; log.debug(<br>                                    &quot;Stop result: {} [Native stop result: {}]&quot;,<br>                                    stopResult,<br>                                    stopResult.unwrap(Object.class)));<br>                    final URI uri = instance.configuration().baseUri();<br>                    log.debug(<br>                                    &quot;Instance {} running at {} [Native handle: {}].%n&quot;,<br>                                    instance, uri,<br>                                    instance.unwrap(Object.class));<br>                    log.debug(&quot;Send SIGKILL to shutdown.&quot;);<br>            })<br>            .toCompletableFuture().join();<br>        // stop quit.<br>        System.in.read();<br>    }<br>}</pre><p>The @Slf4j is from Lombok, which will add a org.slf4j.Logger declaration to Main class at compile time.</p><p>To customize SeBootstrap, use SeBootstrap.Configuration.builder() to produces a SeBootstrap.Configuration which can be used as a parameter to start SeBootstrap instance.</p><p>The SeBootstrap.start accepts the REST Application entry class and an optional SeBootstrap.Configuration, in thenAccept block, a Bootstrap server instance is available to consume. The instance.stopOnShutdown is used to setup a shutdown hook, then print the application startup information.</p><p>The .toCompletableFuture().join() will wait the asynchronous execution to be completed.</p><p>Let’s have a look at RestConfig - which is the REST Application entry class.</p><pre>@ApplicationPath(&quot;/api&quot;)<br>public class RestConfig extends Application {<br>    @Override<br>    public Set&lt;Class&lt;?&gt;&gt; getClasses() {<br>        return Set.of(GreetingResource.class);<br>    }<br>}</pre><p>Add a simple Jaxrs Resource — GreetingResource.</p><pre>@Path(&quot;greeting&quot;)<br>@RequestScoped<br>public class GreetingResource {<br>@GET<br>    public String hello(@QueryParam(&quot;name&quot;) String name) {<br>        return &quot;Say &#39;Hello&#39; to &quot; + (name == null ? &quot;World&quot; : name) + &quot; at &quot; + LocalDateTime.now();<br>    }<br>}</pre><p>Although CDI <em>beans.xml</em> is optional in Jakarta EE environment, it is a must when using SeBootstrap API in a Java SE environment.</p><p>Create an empty CDI <em>beans.xml</em>, put it into the project folder <em>src/main/resources/META-INFO</em>.</p><pre>&lt;beans xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;<br>  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>  xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/beans_4_0.xsd&quot;<br>  bean-discovery-mode=&quot;annotated&quot; version=&quot;4.0&quot;&gt;<br>&lt;/beans&gt;</pre><p>To run this application, it requires a HTTP embedded server at runtime. Both Jersey and Resteasy provides several options.</p><h3>Jersey</h3><p>Create a standard Maven profile for Jersey, add the following dependencies.</p><pre>&lt;profiles&gt;<br>    &lt;profile&gt;<br>        &lt;id&gt;jersey&lt;/id&gt;<br>        &lt;activation&gt;<br>            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;<br>        &lt;/activation&gt;<br>        &lt;dependencies&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.glassfish.jersey.core&lt;/groupId&gt;<br>                &lt;artifactId&gt;jersey-server&lt;/artifactId&gt;<br>            &lt;/dependency&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.glassfish.jersey.containers&lt;/groupId&gt;<br>                &lt;artifactId&gt;jersey-container-jdk-http&lt;/artifactId&gt;<br>            &lt;/dependency&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;org.glassfish.jersey.inject&lt;/groupId&gt;<br>                &lt;artifactId&gt;jersey-cdi2-se&lt;/artifactId&gt;<br>            &lt;/dependency&gt;<br>        &lt;/dependencies&gt;<br>    &lt;/profile&gt;<br>    //...</pre><p>There are <a href="https://repo1.maven.org/maven2/org/glassfish/jersey/containers/">several Jersey containers</a> provided in the latest Jersey. Here we used the simplest one which is based on the JDK built-in HttpServer.</p><p>Now run the Main class in your IDEs directly by click the run button.</p><p>You will see the following info in the console window.</p><pre>Nov 22, 2022 10:42:46 PM org.glassfish.jersey.message.internal.MessagingBinders$EnabledProvidersBinder bindToBinder<br>WARNING: A class jakarta.activation.DataSource for a default provider MessageBodyWriter&lt;jakarta.activation.DataSource&gt; was not found. The provider is not available.<br>Nov 22, 2022 10:42:46 PM org.glassfish.jersey.server.wadl.WadlFeature configure<br>WARNING: JAX-B API not found . WADL feature is disabled.<br>2022-11-22 22:42:46,667 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.bootstrap.WeldStartup: WELD-000900: 5.0.1 (Final)<br>2022-11-22 22:42:46,935 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.environment.deployment.discovery.ReflectionDiscoveryStrategy: WELD-ENV-000014: Falling back to Java Reflection for bean-discovery-mode=&quot;annotated&quot; discovery. Add org.jboss:jandex to the classpath to speed-up startup.<br>2022-11-22 22:42:47,035 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.bootstrap.WeldStartup: WELD-000101: Transactional services not available. Injection of @Inject UserTransaction not available. Transactional observers will be invoked synchronously.<br>2022-11-22 22:42:47,796 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.environment.se.WeldContainer: WELD-ENV-002003: Weld SE container eb0f72e8-e3e1-4f72-bbae-045cc3791db4 initialized<br>2022-11-22 22:42:48,005 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Instance org.glassfish.jersey.server.internal.RuntimeDelegateImpl$1@2c7c9fa9 running at http://localhost:8080/ [Native handle: org.glassfish.jersey.jdkhttp.JdkHttpServer@57458589].%n<br>2022-11-22 22:42:48,006 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Send SIGKILL to shutdown.</pre><p>Open another terminal window, and use curl command to test the /api/greeting endpoint.</p><pre>curl http://localhost:8080/api/greeting?name=Hantsy</pre><pre>Say &#39;Hello&#39; to Hantsy at 2022-11-22T22:45:41.129167100</pre><p>Utilize with maven-assemble-plugin, it will package the application classes with all dependencies into one archive.</p><pre>&lt;!-- Maven Assembly Plugin --&gt;<br>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;3.4.2&lt;/version&gt;<br>    &lt;configuration&gt;<br>        &lt;descriptorRefs&gt;<br>            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;<br>        &lt;/descriptorRefs&gt;<br>        &lt;!-- MainClass in mainfest make a executable jar --&gt;<br>        &lt;archive&gt;<br>            &lt;manifest&gt;<br>                &lt;addClasspath&gt;true&lt;/addClasspath&gt;<br>                &lt;mainClass&gt;com.example.Main&lt;/mainClass&gt;<br>            &lt;/manifest&gt;<br>        &lt;/archive&gt;<br>    &lt;/configuration&gt;<br>        &lt;executions&gt;<br>            &lt;execution&gt;<br>                &lt;id&gt;make-assembly&lt;/id&gt;<br>                &lt;phase&gt;package&lt;/phase&gt; &lt;!-- bind to the packaging phase --&gt;<br>                &lt;goals&gt;<br>                    &lt;goal&gt;single&lt;/goal&gt;<br>                &lt;/goals&gt;<br>            &lt;/execution&gt;<br>        &lt;/executions&gt;<br>    &lt;/plugin&gt;</pre><p>Open a terminal, and switch to the project root, and run the following command to build the application into a jar archive.</p><pre>&gt;mvn clean package -DskipTests -D&quot;maven.test.skip=true&quot;<br>...<br>[INFO]<br>[INFO] --- maven-assembly-plugin:3.4.2:single (make-assembly) @ rest-se-bootstrap-examples ---<br>[INFO] Building jar: D:\hantsylabs\jakartaee10-sandbox\rest-se-bootstrap\target\rest-se-bootstrap-examples-jar-with-dependencies.jar<br>...</pre><p>Then run the application using the following command.</p><pre>&gt;java -jar .\target\rest-se-bootstrap-examples-jar-with-dependencies.jar<br>...<br>WELD-000101: Transactional services not available. Injection of @Inject UserTransaction not available.<br>Transactional observers will be invoked synchronously.<br>2022-11-26 13:50:45,132 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.environment.se.WeldContainer: WELD-ENV-002003: Weld SE container 4744564b-922c-4612-a88f-8095c4d7293b initialized<br>2022-11-26 13:50:45,257 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Instance org.glassfish.jersey.server.internal.RuntimeDelegateImpl$1@2fa5468d running at http://localhost:8080/ [Native handle: org.glassfish.jersey.jdkhttp.JdkHttpServer@78879a1c].%n<br>2022-11-26 13:50:45,257 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Send SIGKILL to shutdown.</pre><p>Similarly you can use the above curl command to verify the /greeting endpoint.</p><h3>Resteasy</h3><p>Let’s switch to use Redhat <a href="https://resteasy.dev/">Resteasy</a> as runtime.</p><p>Create a new Maven profile for Resteasy.</p><pre>&lt;profile&gt;<br>    &lt;id&gt;resteasy&lt;/id&gt;<br>    &lt;properties&gt;<br>        &lt;jboss-logmanager.version&gt;2.1.19.Final&lt;/jboss-logmanager.version&gt;<br>    &lt;/properties&gt;<br>    &lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.jboss.logmanager&lt;/groupId&gt;<br>            &lt;artifactId&gt;jboss-logmanager&lt;/artifactId&gt;<br>            &lt;version&gt;${jboss-logmanager.version}&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;<br>            &lt;artifactId&gt;resteasy-undertow-cdi&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br>    &lt;build&gt;<br>        &lt;plugins&gt;<br>            &lt;plugin&gt;<br>                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br>                &lt;configuration&gt;<br>                    &lt;systemPropertyVariables&gt;<br>                        &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;<br>                    &lt;/systemPropertyVariables&gt;<br>                &lt;/configuration&gt;<br>            &lt;/plugin&gt;<br>        &lt;/plugins&gt;<br>    &lt;/build&gt;<br>&lt;/profile&gt;</pre><p>There are <a href="https://docs.jboss.org/resteasy/docs/6.2.1.Final/userguide/html_single/index.html#RESTEasy_Embedded_Container">several Embedded containers</a> existed in the latest Resteasy. Here we choose resteasy-undertow-cdi that based on Redhat Undertow with CDI support.</p><p>Open a terminal, switch to the project root, and run the following command to start the application in this Resteasy embedded server.</p><pre>&gt;mvn clean package -Presteasy  -DskipTests -D&quot;maven.test.skip=true&quot;<br>...<br>[INFO] --- maven-assembly-plugin:3.4.2:single (make-assembly) @ rest-se-bootstrap-examples ---<br>[INFO] Building jar: D:\hantsylabs\jakartaee10-sandbox\rest-se-bootstrap\target\rest-se-bootstrap-examples-jar-with-dependencies.jar<br>...<br>&gt;java -jar .\target\rest-se-bootstrap-examples-jar-with-dependencies.jar</pre><pre>...<br>org.jboss.weld.environment.undertow.UndertowContainer: WELD-ENV-001302: Undertow detected, CDI injection will be available in Servlets, Filters and Listeners.<br>2022-11-26 13:44:37,430 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Instance org.jboss.resteasy.core.se.ResteasySeInstance@56cb9a0d running at <a href="http://localhost:8080/">http://localhost:8080/</a> [Native handle: dev.resteasy.embedded.server.UndertowCdiEmbeddedServer@80a8d12].%n<br>2022-11-26 13:44:37,431 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.Main: Send SIGKILL to shutdown.</pre><h3>Testing REST Endpoint</h3><p>With Bootstrap API, it is easy to start and stop the application in JUnit lifecycle hooks.</p><pre>@Slf4j<br>public class SeBootstrapTest {<br>    SeBootstrap.Instance instance;<br>    @SneakyThrows<br>    @BeforeEach<br>    public void setup() {<br>        var latch = new CountDownLatch(1);<br>        SeBootstrap.start(RestConfig.class)<br>                .thenAccept(it -&gt; {<br>                    instance = it;<br>                    latch.countDown();<br>                })<br>                .toCompletableFuture().join();<br>        latch.await(1000, java.util.concurrent.TimeUnit.MILLISECONDS);<br>    }<br>    @AfterEach<br>    public void teardown() {<br>        instance.stop()<br>                .thenAccept(<br>                        stopResult -&gt; log.debug(<br>                                &quot;Stop result: {} [Native stop result: {}]&quot;,<br>                                stopResult,<br>                                stopResult.unwrap(Object.class)<br>                        )<br>                ).toCompletableFuture().join();<br>    }<br>// tests<br>}</pre><p>Add a test to verify the functionality of GreetingResource.</p><pre>@Slf4j<br>public class SeBootstrapTest {<br><br>private final ExecutorService executorService = Executors.newFixedThreadPool(5);<br>    private final HttpClient httpClient = HttpClient.newBuilder()<br>            .executor(executorService)<br>            .version(HttpClient.Version.HTTP_2)<br>            .build();<br>    // @BeforeEach and @AfterEach...<br>    @Test<br>    public void testGreetingEndpoints() {<br>        var greetingUri = instance.configuration().baseUriBuilder().path(&quot;/api/greeting&quot;).queryParam(&quot;name&quot;, &quot;Hantsy&quot;).build();<br>        log.debug(&quot;greetingUri: {}&quot;, greetingUri);<br>        this.httpClient<br>                .sendAsync(<br>                        HttpRequest.newBuilder()<br>                                .GET()<br>                                .uri(greetingUri)<br>                                .header(&quot;Accept&quot;, &quot;application/json&quot;)<br>                                .build()<br>                        ,<br>                        HttpResponse.BodyHandlers.ofString()<br>                )<br>                .thenApply(HttpResponse::body)<br>                .thenAccept(body -&gt; {<br>                    log.debug(&quot;Greeting: {}&quot;, body);<br>                    assertThat(body).contains(&quot;Say &#39;Hello&#39; to Hantsy at&quot;);<br>                })<br>                .join();<br>    }<br>}</pre><p>Here we use Java 11 built-in HttClient to shake hands with the /api/greeting endpoint.</p><p>Execute the following command to run tests.</p><pre>&gt;mvn clean test<br>...<br>2022-11-26 16:45:57,721 DEBUG [main] com.example.SeBootstrapTest: greetingUri: http://localhost:8080/api/greeting?name=Hantsy<br>2022-11-26 16:45:58,103 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.SeBootstrapTest: Greeting: Say &#39;Hello&#39; to Hantsy at 2022-11-26T16:45:58.022505600<br>2022-11-26 16:45:58,211 INFO  [ForkJoinPool.commonPool-worker-1] org.jboss.weld.environment.se.WeldContainer: WELD-ENV-002001: Weld SE<br>container e388f80d-f026-41cb-999d-6f2ed757a1b5 shut down<br>2022-11-26 16:45:58,213 DEBUG [ForkJoinPool.commonPool-worker-1] com.example.SeBootstrapTest: Stop result: org.glassfish.jersey.server.internal.RuntimeDelegateImpl$1$1@2df99c23 [Native stop result: null]<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.694 s - in com.example.SeBootstrapTest<br>[INFO]<br>[INFO] Results:<br>[INFO]<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0<br>[INFO]<br>[INFO] ------------------------------------------------------------------------<br>[INFO] BUILD SUCCESS<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Total time:  15.225 s<br>[INFO] Finished at: 2022-11-26T16:45:58+08:00<br>[INFO] ------------------------------------------------------------------------</pre><h3>Multipart APIs</h3><p>Both Jersey and Resteasy have their own Multipart implementations. In Jakarta REST 3.1, it finally brings the standardized Multipart APIs support.</p><p>Follow the steps in <a href="https://github.com/hantsy/jakartaee10-sandbox/blob/master/docs/jpa/jakartaee.md">Jakarta Persistence — Jakarta EE</a> and create a simple Jakarta EE project.</p><p>Firstly let’s a simple Jaxrs resource to consume Multipart request and produce Multipart response.</p><pre>@Path(&quot;multiparts&quot;)<br>@RequestScoped<br>public class MultipartResource {<br>    private static final Logger LOGGER = Logger.getLogger(MultipartResource.class.getName());<br><br>java.nio.file.Path uploadedPath;<br>    @PostConstruct<br>    public void init() {<br>        try {<br>            uploadedPath = Files.createTempDirectory(Paths.get(&quot;/temp&quot;), &quot;uploads_&quot;);<br>        } catch (IOException e) {<br>            throw new RuntimeException(e);<br>        }<br>    }<br><br>    @Path(&quot;simple&quot;)<br>    @POST<br>    @Consumes(MediaType.MULTIPART_FORM_DATA)<br>    public Response uploadFile(@FormParam(&quot;name&quot;) String name,<br>                               @FormParam(&quot;part&quot;) EntityPart part) {<br>        LOGGER.log(Level.INFO, &quot;name: {0} &quot;, name);<br>        LOGGER.log(<br>                Level.INFO,<br>                &quot;uploading file: {0},{1},{2},{3}&quot;,<br>                new Object[]{<br>                        part.getMediaType(),<br>                        part.getName(),<br>                        part.getFileName(),<br>                        part.getHeaders()<br>                }<br>        );<br>        try {<br>            Files.copy(<br>                    part.getContent(),<br>                    Paths.get(uploadedPath.toString(), part.getFileName().orElse(generateFileName(UUID.randomUUID().toString(), mediaTypeToFileExtension(part.getMediaType())))),<br>                    StandardCopyOption.REPLACE_EXISTING<br>            );<br>        } catch (IOException e) {<br>            throw new RuntimeException(e);<br>        }<br>        return Response.ok().build();<br>    }<br>    @Path(&quot;list&quot;)<br>    @POST<br>    @Consumes(MediaType.MULTIPART_FORM_DATA)<br>    public Response uploadMultiFiles(List&lt;EntityPart&gt; parts) {<br>        LOGGER.log(Level.INFO, &quot;Uploading files: {0}&quot;, parts.size());<br>        parts.forEach(<br>                part -&gt; {<br>                    LOGGER.log(<br>                            Level.INFO,<br>                            &quot;uploading multifiles: {0},{1},{2},{3}&quot;,<br>                            new Object[]{<br>                                    part.getMediaType(),<br>                                    part.getName(),<br>                                    part.getFileName(),<br>                                    part.getHeaders()<br>                            }<br>                    );<br>                    try {<br>                        Files.copy(<br>                                part.getContent(),<br>                                Paths.get(uploadedPath.toString(), part.getFileName().orElse(generateFileName(UUID.randomUUID().toString(), mediaTypeToFileExtension(part.getMediaType())))),<br>                                StandardCopyOption.REPLACE_EXISTING<br>                        );<br>                    } catch (IOException e) {<br>                        throw new RuntimeException(e);<br>                    }<br>                }<br>        );<br>        return Response.ok().build();<br>    }<br>    @GET<br>    public List&lt;EntityPart&gt; getFiles() throws IOException {<br>        List&lt;EntityPart&gt; parts = new ArrayList&lt;&gt;();<br>        parts.add(EntityPart.withName(&quot;abd&quot;)<br>                .fileName(&quot;abc.text&quot;).content(&quot;this is a text content&quot;)<br>                .mediaType(MediaType.TEXT_PLAIN_TYPE)<br>                .build()<br>        );<br>        try (var files = Files.list(uploadedPath)) {<br>            var partsInUploaded = files<br>                    .map(path -&gt; {<br>                                var file = path.toFile();<br>                                LOGGER.log(Level.INFO, &quot;found uploaded file: {0}&quot;, file.getName());<br>                                try {<br>                                    return EntityPart.withName(file.getName())<br>                                            .fileName(file.getName())<br>                                            .content(new FileInputStream(file))<br>                                            .mediaType(fileExtensionToMediaType(getFileExt(file.getName())))<br>                                            .build();<br>                                } catch (IOException e) {<br>                                    throw new RuntimeException(e);<br>                                }<br>                            }<br>                    )<br>                    .toList();<br>            parts.addAll(partsInUploaded);<br>        }<br>        return parts;<br>    }<br>    private String getFileExt(String fileName) {<br>        return fileName.substring(fileName.lastIndexOf(&quot;.&quot;) + 1);<br>    }<br>    private MediaType fileExtensionToMediaType(String extension) {<br>        return switch (extension.toLowerCase()) {<br>            case &quot;txt&quot; -&gt; MediaType.TEXT_PLAIN_TYPE;<br>            case &quot;svg&quot; -&gt; MediaType.APPLICATION_SVG_XML_TYPE;<br>            default -&gt; MediaType.APPLICATION_OCTET_STREAM_TYPE;<br>        };<br>    }<br>    private String generateFileName(String fileName, String extension) {<br>        return fileName + &quot;.&quot; + extension;<br>    }<br>    private String mediaTypeToFileExtension(MediaType mediaType) {<br>        return switch (mediaType.toString()) {<br>            case &quot;text/plain&quot; -&gt; &quot;txt&quot;;<br>            case &quot;application/svg+xml&quot; -&gt; &quot;svg&quot;;<br>            default -&gt; &quot;bin&quot;;<br>        };<br>    }<br>}</pre><p>To handle a multipart/form-data request, add @Consumes(MediaType.MULTIPART_FORM_DATA) on the Jaxrs resource methods. A Jaxrs resource can consume a single EntityPart or a collection of EntityPart .</p><p>In the above example codes, the uploadFile method demonstrates how to handle a regular form post which includes a simple form value and a EntityPart, and uploadMultiFiles method is used to process a list of EntityPart. The getFiles method is used to produce a collection of Multipart entities to the client.</p><p>Create a REST Application to activate Jakarta REST.</p><pre>@ApplicationPath(&quot;api&quot;)<br>public class RestConfig extends Application {<br>}</pre><p>Run the following command, it will build the project and package it into a war archive, and then start a GlassFish instance and deploy the war archive to GlassFish.</p><pre>&gt; mvn clean package cargo:run</pre><p>Alternatively, run the following command to deploy to WildFly if you prefer WildFly.</p><pre>&gt; mvn clean wildfly:run</pre><p>When the deployment work is done, open another terminal, and let’s test our endpoints with curl command.</p><pre>&gt; curl -i -X POST  http://localhost:8080/rest-examples/api/multiparts/simple -F &quot;name=Hantsy&quot; -F &quot;part=@D:\temp\test.txt&quot; -H &quot;Content-Type: multipart/form-data&quot;<br>HTTP/1.1 200 OK<br>Server: Eclipse GlassFish  7.0.0</pre><p>Open the GlassFish server.log file, it appends the following new info.</p><pre>[2022-12-03T20:52:36.002626+08:00] [GlassFish 7.0] [INFO] [] [com.example.MultipartResource] [tid: _ThreadID=61 _ThreadName=http-listener-1(1)] [levelValue: 800] [[<br>  name: Hantsy ]]<br>[2022-12-03T20:52:36.003632+08:00] [GlassFish 7.0] [INFO] [] [com.example.MultipartResource] [tid: _ThreadID=61 _ThreadName=http-listener-1(1)] [levelValue: 800] [[<br>  uploading file: text/plain,part,Optional[test.txt],{Content-Disposition=[form-data; name=&quot;part&quot;; filename=&quot;test.txt&quot;], Content-Type=[text/plain]}]]</pre><p>Let’s try to upload multiple files using /list endpoints.</p><pre>&gt; curl -i -X POST  http://localhost:8080/rest-examples/api/multiparts/list -F &quot;test=@D:\temp\test.txt&quot; -F &quot;test2=@D:\temp\test2.txt&quot; -H &quot;Content-Type: multipart/form-data&quot;<br>HTTP/1.1 200 OK<br>Server: Eclipse GlassFish  7.0.0</pre><p>In the GlassFish server.log file, the following new log is newly added.</p><pre>[2022-12-03T20:58:54.140995+08:00] [GlassFish 7.0] [INFO] [] [com.example.MultipartResource] [tid: _ThreadID=65 _ThreadName=http-listener-1(5)] [levelValue: 800] [[<br>  Uploading files: 2]]<br>[2022-12-03T20:58:54.142996+08:00] [GlassFish 7.0] [INFO] [] [com.example.MultipartResource] [tid: _ThreadID=65 _ThreadName=http-listener-1(5)] [levelValue: 800] [[<br>  uploading multifiles: text/plain,test,Optional[test.txt],{Content-Disposition=[form-data; name=&quot;test&quot;; filename=&quot;test.txt&quot;], Content-Type=[text/plain]}]]<br>[2022-12-03T20:58:54.145995+08:00] [GlassFish 7.0] [INFO] [] [com.example.MultipartResource] [tid: _ThreadID=65 _ThreadName=http-listener-1(5)] [levelValue: 800] [[<br>  uploading multifiles: text/plain,test2,Optional[test2.txt],{Content-Disposition=[form-data; name=&quot;test2&quot;; filename=&quot;test2.txt&quot;], Content-Type=[text/plain]}]]</pre><p>Let’s try to send a GET request to fetch the multipart data.</p><pre>&gt;curl -v http://localhost:8080/rest-examples/api/multiparts -H &quot;Accept: multipart/form-data&quot;</pre><pre>* Connected to localhost (127.0.0.1) port 8080 (#0)<br>&gt; GET /rest-examples/api/multiparts HTTP/1.1<br>&gt; Host: localhost:8080<br>&gt; User-Agent: curl/7.83.1<br>&gt; Accept: multipart/form-data<br>&gt;<br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/1.1 200 OK<br>&lt; Server: Eclipse GlassFish  7.0.0<br>&lt; X-Powered-By: Servlet/6.0 JSP/3.1(Eclipse GlassFish  7.0.0  Java/Oracle Corporation/17)<br>&lt; MIME-Version: 1.0<br>&lt; Content-Type: multipart/form-data;boundary=Boundary_1_1941664842_1670072479638<br>&lt; Content-Length: 197<br>&lt;<br>--Boundary_1_1941664842_1670072479638<br>Content-Type: text/plain<br>Content-Disposition: form-data; filename=&quot;abc.text&quot;; name=&quot;abd&quot;</pre><pre>this is a text content<br>--Boundary_1_1941664842_1670072479638--</pre><p>Jaxrs also includes Client API to shake hands with the Multipart endpoints. With the Client API, it is easy to upload or download the Multipart entities.</p><p>Let’s create an Arquillian test and use Jaxrs Client API to verify the above endpoints.</p><pre>@ExtendWith(ArquillianExtension.class)<br>public class MultipartResourceTest {<br><br>private final static Logger LOGGER = Logger.getLogger(MultipartResourceTest.class.getName());<br><br>@Deployment(testable = false)<br>    public static WebArchive createDeployment() {<br>        File[] extraJars = Maven<br>                .resolver()<br>                .loadPomFromFile(&quot;pom.xml&quot;)<br>                .importCompileAndRuntimeDependencies()<br>                .resolve(&quot;org.assertj:assertj-core&quot;)<br>                .withTransitivity()<br>                .asFile();<br>        var war = ShrinkWrap.create(WebArchive.class)<br>                .addAsLibraries(extraJars)<br>                .addClasses(MultipartResource.class, RestConfig.class)<br>                .addAsWebInfResource(EmptyAsset.INSTANCE, &quot;beans.xml&quot;);<br>        LOGGER.log(Level.INFO, &quot;war deployment: {0}&quot;, new Object[]{war.toString(true)});<br>        return war;<br>    }<br>    @ArquillianResource<br>    private URL baseUrl;<br>    Client client;<br>    @BeforeEach<br>    public void before() throws Exception {<br>        LOGGER.log(Level.INFO, &quot;baseURL: {0}&quot;, new Object[]{baseUrl.toExternalForm()});<br>        client = ClientBuilder.newClient();<br>        client.register(MultiPartFeature.class);<br>    }<br>    @AfterEach<br>    public void after() throws Exception {<br>        client.close();<br>    }<br>    @Test<br>    @RunAsClient<br>    public void testUploadSingleFile() throws Exception {<br>        var target = client.target(URI.create(baseUrl.toExternalForm() + &quot;api/multiparts/simple&quot;));<br>        var part = EntityPart.withName(&quot;part&quot;).fileName(&quot;test.txt&quot;)<br>                .content(this.getClass().getResourceAsStream(&quot;/test.txt&quot;))<br>                .mediaType(MediaType.TEXT_PLAIN_TYPE)<br>                .build();<br>        var name = EntityPart.withName( &quot;name&quot;).content(&quot;test&quot;).build();<br>        var genericEntity = new GenericEntity&lt;List&lt;EntityPart&gt;&gt;(List.of(name, part)) {};<br>        var entity = Entity.entity(genericEntity, MediaType.MULTIPART_FORM_DATA);<br>        Response r = target.request(MediaType.MULTIPART_FORM_DATA).post(entity);<br>        LOGGER.log(Level.INFO, &quot;response status: {0}&quot;, r.getStatus());<br>        assertEquals(200, r.getStatus());<br>    }<br>    @Test<br>    @RunAsClient<br>    public void testUploadMultiFiles() throws Exception {<br>        var target = client.target(URI.create(baseUrl.toExternalForm() + &quot;api/multiparts/list&quot;));<br>        List&lt;EntityPart&gt; parts = List.of(<br>                EntityPart.withName(&quot;textFile&quot;).fileName(&quot;test.txt&quot;)<br>                        .content(this.getClass().getResourceAsStream(&quot;/test.txt&quot;))<br>                        .mediaType(MediaType.TEXT_PLAIN_TYPE)<br>                        .build(),<br>                EntityPart.withName(&quot;imageFile&quot;).fileName(&quot;test.svg&quot;)<br>                        .content(this.getClass().getResourceAsStream(&quot;/test.svg&quot;))<br>                        .mediaType(MediaType.APPLICATION_SVG_XML_TYPE)<br>                        .build()<br>        );<br>        var genericEntity = new GenericEntity&lt;List&lt;EntityPart&gt;&gt;(parts) {};<br>        var entity = Entity.entity(genericEntity, MediaType.MULTIPART_FORM_DATA);<br>        Response r = target.request().post(entity);<br>        assertEquals(200, r.getStatus());<br>        LOGGER.log(Level.INFO, &quot;Upload multiple files response status: {0}&quot;, r.getStatus());<br>    }<br>    @Test<br>    @RunAsClient<br>    public void testGetFiles() {<br>        var target = client.target(URI.create(baseUrl.toExternalForm() + &quot;api/multiparts&quot;));<br>        Response response = target.request().accept(MediaType.MULTIPART_FORM_DATA).get();<br>        assertEquals(200, response.getStatus());<br>        LOGGER.log(Level.INFO, &quot;GetFiles response status: {0}&quot;, response.getStatus());<br>        List&lt;EntityPart&gt; parts = response.readEntity(new GenericType&lt;List&lt;EntityPart&gt;&gt;() {});<br>        parts.forEach(part -&gt; LOGGER.log(<br>                Level.INFO,<br>                &quot;Get file: {0},{1},{2},{3}&quot;,<br>                new Object[]{<br>                        part.getMediaType(),<br>                        part.getName(),<br>                        part.getFileName(),<br>                        part.getHeaders()<br>                }<br>        ));<br>    }<br>}</pre><p>In this test, there are three methods to verify the functionality of uploading a single file, uploading a collection of files, and reading the files from server side.</p><p>Run the following command to execute the test.</p><pre>&gt;  mvn clean verify -Parq-glassfish-managed -D&quot;it.test=MultipartResourceTest&quot;<br>...</pre><pre>[INFO] --- maven-failsafe-plugin:3.0.0-M7:integration-test (integration-test) @ rest-examples ---<br>[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider<br>[INFO]<br>[INFO] -------------------------------------------------------<br>[INFO]  T E S T S<br>[INFO] -------------------------------------------------------<br>[INFO] Running com.example.it.MultipartResourceTest<br>Starting database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-database, -t]<br>Starting database in the background.<br>Log redirected to D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\databases\derby.log.<br>Starting container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-domain, -t]<br>Attempting to start domain1.... Please look at the server log for more details.....<br>SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.<br>SLF4J: Defaulting to no-operation (NOP) logger implementation<br>SLF4J: See <a href="http://www.slf4j.org/codes.html#StaticLoggerBinder">http://www.slf4j.org/codes.html#StaticLoggerBinder</a> for further details.<br>Dec 03, 2022 9:21:19 PM com.example.it.MultipartResourceTest createDeployment<br>INFO: war deployment: 3ca3304d-1523-4473-bd4d-a7074b2ae48b.war:<br>/WEB-INF/<br>/WEB-INF/lib/<br>/WEB-INF/lib/assertj-core-3.23.1.jar<br>/WEB-INF/lib/byte-buddy-1.12.10.jar<br>/WEB-INF/classes/<br>/WEB-INF/classes/com/<br>/WEB-INF/classes/com/example/<br>/WEB-INF/classes/com/example/MultipartResource.class<br>/WEB-INF/classes/com/example/RestConfig.class<br>/WEB-INF/beans.xml<br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest before<br>INFO: baseURL: <a href="http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/">http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/</a><br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest testUploadSingleFile<br>INFO: response status: 200<br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest before<br>INFO: baseURL: <a href="http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/">http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/</a><br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest testGetFiles<br>INFO: GetFiles response status: 200<br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest lambda$testGetFiles$0<br>INFO: Get file: text/plain,abd,Optional[abc.text],{Content-Type=[text/plain], Content-Disposition=[form-data; filename=&quot;abc.text&quot;; name=&quot;abd&quot;]}<br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest lambda$testGetFiles$0<br>INFO: Get file: text/plain,test.txt,Optional[test.txt],{Content-Type=[text/plain], Content-Disposition=[form-data; filename=&quot;test.txt&quot;; name=&quot;test.txt&quot;]}<br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest before<br>INFO: baseURL: <a href="http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/">http://localhost:8080/3ca3304d-1523-4473-bd4d-a7074b2ae48b/</a><br>Dec 03, 2022 9:21:28 PM com.example.it.MultipartResourceTest testUploadMultiFiles<br>INFO: Upload multiple files response status: 200<br>[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 74.084 s - in com.example.it.MultipartResourceTest<br>Stopping container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-domain, --kill, -t]<br>Stopping database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-database, -t]<br>Sat Dec 03 21:21:33 CST 2022 : Connection obtained for host: 0.0.0.0, port number 1527.<br>Sat Dec 03 21:21:33 CST 2022 : Apache Derby Network Server - 10.15.2.0 - (1873585) shutdown<br>[INFO]<br>[INFO] Results:<br>[INFO]<br>[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0<br>[INFO]<br>[INFO]<br>[INFO] --- maven-failsafe-plugin:3.0.0-M7:verify (integration-test) @ rest-examples ---<br>[INFO] ------------------------------------------------------------------------<br>[INFO] BUILD SUCCESS<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Total time:  01:44 min<br>[INFO] Finished at: 2022-12-03T21:21:34+08:00<br>[INFO] ------------------------------------------------------------------------</pre><h3>Customizing Jsonb</h3><p>In Jaxrs 3.1, it is possible to customize Jsonb to tune the serialization and deserialization of the HTTP messages.</p><pre>@Provider<br>public class JsonbContextResolver implements ContextResolver&lt;Jsonb&gt; {<br>    @Override<br>    public Jsonb getContext(Class&lt;?&gt; type) {<br>        JsonbConfig config = new JsonbConfig()<br>                .withPropertyNamingStrategy(PropertyNamingStrategy.UPPER_CAMEL_CASE)<br>                .withFormatting(true)<br>                .withNullValues(false);<br>        return JsonbBuilder.newBuilder().withConfig(config).build();<br>    }<br>}</pre><p>In the config, we apply UPPER_CAMEL_CASE strategy on the property name, and format the output result to make it move readable, and filter out the null nodes in JSON.</p><p>Let’s create a simple Jaxrs resource for test purpose.</p><pre>@Path(&quot;greeting&quot;)<br>@RequestScoped<br>public class GreetingResource {<br><br>@GET<br>    @Produces(MediaType.APPLICATION_JSON)<br>    public Response sayHello() {<br>        var person = new GreetingRecord(&quot;Hantsy&quot;, LocalDateTime.now());<br>        return Response.ok(person).build();<br>    }<br>}<br>// GreetingRecord<br>public record GreetingRecord(String name, LocalDateTime sentAt){}</pre><p>Build and run the application on GlassFish or WildFly, and use curl to access the /greeting endpoint.</p><pre>curl http://localhost:8080/rest-examples/api/greeting<br>{<br>    &quot;Name&quot;: &quot;Hantsy&quot;,<br>    &quot;SentAt&quot;: &quot;2022-12-04T15:06:10.2230204&quot;<br>}</pre><p>Let’s create a simple Arquillian test to verify this functionality.</p><pre>@ExtendWith(ArquillianExtension.class)<br>public class GreetingResourceTest {<br><br>private final static Logger LOGGER = Logger.getLogger(GreetingResourceTest.class.getName());<br>    @Deployment(testable = false)<br>    public static WebArchive createDeployment() {<br>        File[] extraJars = Maven<br>                .resolver()<br>                .loadPomFromFile(&quot;pom.xml&quot;)<br>                .importCompileAndRuntimeDependencies()<br>                .resolve(&quot;org.assertj:assertj-core&quot;)<br>                .withTransitivity()<br>                .asFile();<br>        var war = ShrinkWrap.create(WebArchive.class)<br>                .addAsLibraries(extraJars)<br>                .addClasses(GreetingResource.class, GreetingRecord.class, JsonbContextResolver.class, RestConfig.class)<br>                .addAsWebInfResource(EmptyAsset.INSTANCE, &quot;beans.xml&quot;);<br>        LOGGER.log(Level.INFO, &quot;war deployment: {0}&quot;, new Object[]{war.toString(true)});<br>        return war;<br>    }<br>    @ArquillianResource<br>    private URL baseUrl;<br>    Client client;<br>    @BeforeEach<br>    public void before() throws Exception {<br>        LOGGER.log(Level.INFO, &quot;baseURL: {0}&quot;, new Object[]{baseUrl.toExternalForm()});<br>        client = ClientBuilder.newClient();<br>        //client.register(JsonbContextResolver.class);<br>    }<br>    @AfterEach<br>    public void after() throws Exception {<br>        client.close();<br>    }<br>    @Test<br>    @RunAsClient<br>    public void testGetPerson() throws Exception {<br>        var target = client.target(URI.create(baseUrl.toExternalForm() + &quot;api/greeting&quot;));<br>        Response r = target.request().accept(MediaType.APPLICATION_JSON_TYPE).get();<br>        LOGGER.log(Level.INFO, &quot;Get greeting response status: {0}&quot;, r.getStatus());<br>        assertEquals(200, r.getStatus());<br>        String jsonString = r.readEntity(String.class);<br>        LOGGER.log(Level.INFO, &quot;Get greeting result string: {0}&quot;, jsonString);<br>        assertThat(jsonString).doesNotContain(&quot;email&quot;);<br>        assertThat(jsonString).contains(&quot;Name&quot;);<br>    }<br>}</pre><p>Run the test against the previous GlassFish managed adapter that defined in the arq-glassfish-managed Maven profile.</p><pre>&gt; mvn clean verify -Parq-glassfish-managed -D&quot;it.test=GreetingResourceTest&quot;<br>...<br>[INFO] --- maven-failsafe-plugin:3.0.0-M7:integration-test (integration-test) @ rest-examples ---<br>[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider<br>[INFO]<br>[INFO] -------------------------------------------------------<br>[INFO]  T E S T S<br>[INFO] -------------------------------------------------------<br>[INFO] Running com.example.it.GreetingResourceTest<br>Starting database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-database, -t]<br>Starting database in the background.<br>Log redirected to D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\databases\derby.log.<br>Starting container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-domain, -t]<br>Attempting to start domain1.... Please look at the server log for more details.....<br>SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.<br>SLF4J: Defaulting to no-operation (NOP) logger implementation<br>SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.<br>Dec 04, 2022 3:12:58 PM com.example.it.GreetingResourceTest createDeployment<br>INFO: war deployment: d8b12d32-3bac-4092-b30b-612bb887509f.war:<br>/WEB-INF/<br>/WEB-INF/lib/<br>/WEB-INF/lib/assertj-core-3.23.1.jar<br>/WEB-INF/lib/byte-buddy-1.12.10.jar<br>/WEB-INF/classes/<br>/WEB-INF/classes/com/<br>/WEB-INF/classes/com/example/<br>/WEB-INF/classes/com/example/GreetingResource.class<br>/WEB-INF/classes/com/example/GreetingRecord.class<br>/WEB-INF/classes/com/example/JsonbContextResolver.class<br>/WEB-INF/classes/com/example/RestConfig.class<br>/WEB-INF/beans.xml<br>Dec 04, 2022 3:13:08 PM com.example.it.GreetingResourceTest before<br>INFO: baseURL: http://localhost:8080/d8b12d32-3bac-4092-b30b-612bb887509f/<br>Dec 04, 2022 3:13:08 PM com.example.it.GreetingResourceTest testGetPerson<br>INFO: Get greeting response status: 200<br>Dec 04, 2022 3:13:08 PM com.example.it.GreetingResourceTest testGetPerson<br>INFO: Get greeting result string: {<br>    &quot;Name&quot;: &quot;Hantsy&quot;,<br>    &quot;SentAt&quot;: &quot;2022-12-04T15:13:08.4011684&quot;<br>}<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 66.233 s - in com.example.it.GreetingResourceTest<br>Stopping container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-domain, --kill, -t]<br>Stopping database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-database, -t]<br>Sun Dec 04 15:13:13 CST 2022 : Connection obtained for host: 0.0.0.0, port number 1527.<br>Sun Dec 04 15:13:14 CST 2022 : Apache Derby Network Server - 10.15.2.0 - (1873585) shutdown<br>[INFO]<br>[INFO] Results:<br>[INFO]<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0<br>[INFO]<br>[INFO]<br>[INFO] --- maven-failsafe-plugin:3.0.0-M7:verify (integration-test) @ rest-examples ---<br>[INFO] ------------------------------------------------------------------------<br>[INFO] BUILD SUCCESS<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Total time:  01:37 min<br>[INFO] Finished at: 2022-12-04T15:13:14+08:00<br>[INFO] ------------------------------------------------------------------------</pre><p>As you see, it works as expected.</p><h3>CDI as Injection Provider</h3><p>In the initial Jaxrs 3.1 proposal, an exciting feature is using CDI as default injection provider to replace the existing one in Jaxrs, that means you can use Inject to replace Jaxrs Context to inject Jaxrs specific resources. Unfortunately this feature is delayed to the next version, and not included in the final 3.1 version.</p><p>But Jersey itself provides an extra module to implement this feature.</p><p>Let’s create a simple TODO Jaxrs application to expose resources at the /todos endpoint.</p><p>Firstly create a JPA entity — Todo.</p><pre>@Entity<br>@Table(name = &quot;todos&quot;)<br>public class Todo implements Serializable {<br><br>    @Id<br>    @GeneratedValue(strategy = GenerationType.UUID)<br>    UUID id;<br>    String title;<br>    boolean completed = false;<br>    // setters and getters, hashCode and equals<br>}</pre><p>Create a simple EJB @Stateless bean to create a Todo and retrieve todos.</p><pre>@Stateless<br>public class TodoService {<br><br>    @PersistenceContext<br>    EntityManager entityManager;<br><br>    @Transactional<br>    public Todo create(Todo data) {<br>        entityManager.persist(data);<br>        return data;<br>    }<br>    public Todo findById(UUID id) {<br>        return entityManager.find(Todo.class, id);<br>    }<br>    public List&lt;Todo&gt; findAll() {<br>        return entityManager.createQuery(&quot;select t from Todo t&quot;, Todo.class).getResultList();<br>    }<br>}</pre><p>Create a EJB @Singleton bean to initialize some sample data.</p><pre>@Singleton<br>@Startup<br>public class TodoSamples {<br>    private static final Logger LOGGER = Logger.getLogger(TodoSamples.class.getName());<br>    @Inject<br>    TodoService todoService;<br><br>    @PostConstruct<br>    public void init() {<br>        var todos = Stream.of(&quot;What&#39;s new in JPA 3.1?&quot;, &quot;What&#39;s new in Jaxrs 3.1&quot;, &quot;Learn new features in Faces 4.0&quot;)<br>                .map(Todo::new)<br>                .map(it -&gt; todoService.create(it))<br>                .toList();<br>        LOGGER.log(Level.INFO, &quot;initialized todo samples: {0}&quot;, todos);<br>    }<br>}</pre><p>Now create a Jaxrs resource to expose /todos endpoint.</p><pre>@Path(&quot;todos&quot;)<br>@RequestScoped<br>public class TodoResources {<br><br>    @Inject<br>    //@Context<br>    ResourceContext resourceContext;<br>    @Inject<br>    // @Context<br>    UriInfo uriInfo;<br>    @Inject<br>    TodoService todoService;<br>    @GET<br>    public Response getAllTodos() {<br>        var todos = todoService.findAll();<br>        return Response.ok(todos).build();<br>    }<br>    @POST<br>    public Response createTodo(Todo todo) throws Exception {<br>        var saved = todoService.create(todo);<br>        return Response.created(uriInfo.getBaseUriBuilder().path(&quot;todos/{id}&quot;).build(saved.getId())).build();<br>    }<br>    @GET<br>    @Path(&quot;{id}&quot;)<br>    public TodoResource subResource() {<br>        return resourceContext.getResource(TodoResource.class);<br>    }<br>}<br><br>// TodoResource for single resource.<br>@RequestScoped<br>public class TodoResource {<br>    @Inject<br>    TodoService todoService;<br>    @PathParam(&quot;id&quot;)<br>    UUID id;<br>    @GET<br>    public Response getById() {<br>        var todos = todoService.findById(id);<br>        return Response.ok(todos).build();<br>    }<br>}</pre><p>To make sure it works on GlassFish, copy jersey-cdi-rs-inject to the GlassFish <em>GlassFish_installdir/glassfish/modules</em> folder.</p><p>Simply add the following fragment to the glassfish profile, and use maven-dependency-plugin to download a copy of jersey-cdi-rs-inject to the cargo managed GlassFish instance.</p><pre>&lt;plugin&gt;<br>    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;<br>    &lt;version&gt;${maven-dependency-plugin.version}&lt;/version&gt;<br>    &lt;executions&gt;<br>        &lt;execution&gt;<br>            &lt;id&gt;copy&lt;/id&gt;<br>            &lt;phase&gt;process-classes&lt;/phase&gt;<br>            &lt;goals&gt;<br>                &lt;goal&gt;copy&lt;/goal&gt;<br>            &lt;/goals&gt;<br>            &lt;configuration&gt;<br>                &lt;artifactItems&gt;<br>                    &lt;artifactItem&gt;<br>                        &lt;groupId&gt;org.glassfish.jersey.ext.cdi&lt;/groupId&gt;<br>                        &lt;artifactId&gt;jersey-cdi-rs-inject&lt;/artifactId&gt;<br>                        &lt;version&gt;${jersey.version}&lt;/version&gt;<br>                        &lt;type&gt;jar&lt;/type&gt;<br>                        &lt;overWrite&gt;false&lt;/overWrite&gt;<br>                    &lt;/artifactItem&gt;<br>                &lt;/artifactItems&gt;<br>                &lt;outputDirectory&gt;${project.build.directory}/cargo/installs/glassfish-${glassfish.version}/glassfish7/glassfish/modules&lt;/outputDirectory&gt;<br>            &lt;/configuration&gt;<br>        &lt;/execution&gt;<br>    &lt;/executions&gt;<br>&lt;/plugin&gt;</pre><p>Build and run the application, and use curl to test our endpoint /todos.</p><pre>&gt; curl http://localhost:8080/rest-examples/api/todos<br>[<br>    {<br>        &quot;Completed&quot;: false,<br>        &quot;Id&quot;: &quot;7db8cb74-6ec6-4b3b-8930-e6a29a9c363a&quot;,<br>        &quot;Title&quot;: &quot;Learn new features in Faces 4.0&quot;<br>    },<br>    {<br>        &quot;Completed&quot;: false,<br>        &quot;Id&quot;: &quot;0dba2afd-943f-42a2-b1bd-2cd9fea3a140&quot;,<br>        &quot;Title&quot;: &quot;What&#39;s new in JPA 3.1?&quot;<br>    },<br>    {<br>        &quot;Completed&quot;: false,<br>        &quot;Id&quot;: &quot;ff7ac837-fe68-4d47-b79d-f11fd87fd43a&quot;,<br>        &quot;Title&quot;: &quot;What&#39;s new in Jaxrs 3.1&quot;<br>    }<br>]</pre><p>Create a simple Arquillian test to verify the functionality.</p><pre>@ExtendWith(ArquillianExtension.class)<br>public class TodoResourceTest {<br><br>    private final static Logger LOGGER = Logger.getLogger(TodoResourceTest.class.getName());<br>    @Deployment(testable = false)<br>    public static WebArchive createDeployment() {<br>        File[] extraJars = Maven<br>                .resolver()<br>                .loadPomFromFile(&quot;pom.xml&quot;)<br>                .importCompileAndRuntimeDependencies()<br>                .resolve(&quot;org.assertj:assertj-core&quot;)<br>                .withTransitivity()<br>                .asFile();<br>        var war = ShrinkWrap.create(WebArchive.class)<br>                .addAsLibraries(extraJars)<br>                .addClasses(<br>                        TodoResource.class,<br>                        TodoResources.class,<br>                        TodoService.class,<br>                        Todo.class,<br>                        TodoSamples.class,<br>                        RestConfig.class<br>                )<br>                .addAsResource(&quot;test-persistence.xml&quot;, &quot;META-INF/persistence.xml&quot;)<br>                .addAsWebInfResource(EmptyAsset.INSTANCE, &quot;beans.xml&quot;);<br>        LOGGER.log(Level.INFO, &quot;war deployment: {0}&quot;, new Object[]{war.toString(true)});<br>        return war;<br>    }<br>    @ArquillianResource<br>    private URL baseUrl;<br>    Client client;<br>    @BeforeEach<br>    public void before() throws Exception {<br>        LOGGER.log(Level.INFO, &quot;baseURL: {0}&quot;, new Object[]{baseUrl.toExternalForm()});<br>        client = ClientBuilder.newClient();<br>    }<br>    @AfterEach<br>    public void after() throws Exception {<br>        client.close();<br>    }<br>    @Test<br>    @RunAsClient<br>    public void testGetTodos() throws Exception {<br>        var target = client.target(URI.create(baseUrl.toExternalForm() + &quot;api/todos&quot;));<br>        Response r = target.request().accept(MediaType.APPLICATION_JSON_TYPE).get();<br>        LOGGER.log(Level.INFO, &quot;Get /todos response status: {0}&quot;, r.getStatus());<br>        assertEquals(200, r.getStatus());<br>        String jsonString = r.readEntity(String.class);<br>        LOGGER.log(Level.INFO, &quot;Get /todos result string: {0}&quot;, jsonString);<br>    }<br>}</pre><p>To make the test be run successfully on GlassFish, similarly copy jersey-cdi-rs-inject to the target GlassFish server.</p><p>In the arq-glassfish-managed Maven profile, find the dependency-maven-plugin config, add the following content at the end of configuration section.</p><pre>&lt;execution&gt;<br>    &lt;id&gt;copy&lt;/id&gt;<br>    &lt;phase&gt;pre-integration-test&lt;/phase&gt;<br>    &lt;goals&gt;<br>        &lt;goal&gt;copy&lt;/goal&gt;<br>    &lt;/goals&gt;<br>    &lt;configuration&gt;<br>        &lt;artifactItems&gt;<br>            &lt;artifactItem&gt;<br>                &lt;groupId&gt;org.glassfish.jersey.ext.cdi&lt;/groupId&gt;<br>                &lt;artifactId&gt;jersey-cdi-rs-inject&lt;/artifactId&gt;<br>                &lt;version&gt;${jersey.version}&lt;/version&gt;<br>                &lt;type&gt;jar&lt;/type&gt;<br>                &lt;overWrite&gt;false&lt;/overWrite&gt;<br>            &lt;/artifactItem&gt;<br>        &lt;/artifactItems&gt;<br>        &lt;outputDirectory&gt;${project.build.directory}/glassfish7/glassfish/modules&lt;/outputDirectory&gt;<br>    &lt;/configuration&gt;<br>&lt;/execution&gt;</pre><p>Then run TodoResourceTest test.</p><pre>&gt; mvn clean verify -Parq-glassfish-managed -D&quot;it.test=TodoResourceTest&quot;<br>...<br>[INFO] --- maven-failsafe-plugin:3.0.0-M7:integration-test (integration-test) @ rest-examples ---<br>[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider<br>[INFO]<br>[INFO] -------------------------------------------------------<br>[INFO]  T E S T S<br>[INFO] -------------------------------------------------------<br>[INFO] Running com.example.it.TodoResourceTest<br>Starting database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-database, -t]<br>Starting database in the background.<br>Log redirected to D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\databases\derby.log.<br>Starting container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, start-domain, -t]<br>Attempting to start domain1.... Please look at the server log for more details.....<br>SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.<br>SLF4J: Defaulting to no-operation (NOP) logger implementation<br>SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.<br>Dec 04, 2022 5:09:02 PM com.example.it.TodoResourceTest createDeployment<br>INFO: war deployment: 4a77aebc-2b83-44e6-9ab0-f93e656e1b2c.war:<br>/WEB-INF/<br>/WEB-INF/lib/<br>/WEB-INF/lib/assertj-core-3.23.1.jar<br>/WEB-INF/lib/byte-buddy-1.12.10.jar<br>/WEB-INF/classes/<br>/WEB-INF/classes/com/<br>/WEB-INF/classes/com/example/<br>/WEB-INF/classes/com/example/TodoResource.class<br>/WEB-INF/classes/com/example/TodoResources.class<br>/WEB-INF/classes/com/example/TodoService.class<br>/WEB-INF/classes/com/example/Todo.class<br>/WEB-INF/classes/com/example/TodoSamples.class<br>/WEB-INF/classes/com/example/RestConfig.class<br>/WEB-INF/classes/META-INF/<br>/WEB-INF/classes/META-INF/persistence.xml<br>/WEB-INF/beans.xml<br>Dec 04, 2022 5:09:15 PM com.example.it.TodoResourceTest before<br>INFO: baseURL: http://localhost:8080/4a77aebc-2b83-44e6-9ab0-f93e656e1b2c/<br>Dec 04, 2022 5:09:16 PM com.example.it.TodoResourceTest testGetTodos<br>INFO: Get /todos response status: 200<br>Dec 04, 2022 5:09:16 PM com.example.it.TodoResourceTest testGetTodos<br>INFO: Get /todos result string: [{&quot;completed&quot;:false,&quot;id&quot;:&quot;6686c811-71cb-40aa-a38a-24d775c679ba&quot;,&quot;title&quot;:&quot;Learn new features in Faces 4.0&quot;},{&quot;completed&quot;:false,&quot;id&quot;:&quot;8efb7123-0c43-46aa-aabc-0777494be620&quot;,&quot;title&quot;:&quot;What&#39;s new in JPA 3.1?&quot;},{&quot;completed&quot;:false,&quot;id&quot;:&quot;0478a20e-b8c1-4577-91e4-cc0362ab14d5&quot;,&quot;title&quot;:&quot;What&#39;s new in Jaxrs 3.1&quot;}]<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 78.438 s - in com.example.it.TodoResourceTest<br>Stopping container using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-domain, --kill, -t]<br>Stopping database using command: [java, -jar, D:\hantsylabs\jakartaee10-sandbox\rest\target\glassfish7\glassfish\modules\admin-cli.jar, stop-database, -t]<br>Sun Dec 04 17:09:20 CST 2022 : Connection obtained for host: 0.0.0.0, port number 1527.<br>Sun Dec 04 17:09:20 CST 2022 : Apache Derby Network Server - 10.15.2.0 - (1873585) shutdown<br>[INFO]<br>[INFO] Results:<br>[INFO]<br>[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0<br>[INFO]<br>[INFO]<br>[INFO] --- maven-failsafe-plugin:3.0.0-M7:verify (integration-test) @ rest-examples ---<br>[INFO] ------------------------------------------------------------------------<br>[INFO] BUILD SUCCESS<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Total time:  01:45 min<br>[INFO] Finished at: 2022-12-04T17:09:21+08:00<br>[INFO] ------------------------------------------------------------------------</pre><p>Get the <a href="https://github.com/hantsy/jakartaee10-sandbox/blob/master/rest/">sample codes</a> from my Github account.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=dbe13fe6988c" width="1" height="1" alt=""><hr><p><a href="https://itnext.io/jakarta-rest-3-1-by-examples-dbe13fe6988c">Jakarta REST 3.1 by Examples</a> was originally published in <a href="https://itnext.io">ITNEXT</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
